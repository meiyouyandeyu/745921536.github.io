<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="2022NewStarwp(RE)">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStar2022wp">
<meta property="og:url" content="https://username.github.io/2022/09/30/NewStar2022wp/index.html">
<meta property="og:site_name" content="鱼先生的格纳库">
<meta property="og:description" content="2022NewStarwp(RE)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302355656.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302357832.png">
<meta property="og:image" content="c:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20220930235756541.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302359126.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302302631.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302311855.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302331867.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302332309.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302336501.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302337828.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302337343.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302338908.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302339783.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302339262.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302340721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302342569.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302343811.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052031914.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052050170.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052052356.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052256416.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052257088.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052300048.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052301365.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052301734.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052302681.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052304318.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052304238.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052308550.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052308108.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142259051.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142304500.png">
<meta property="og:image" content="c:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20221014230607425.png">
<meta property="og:image" content="c:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20221014223810878.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142239382.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142240132.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142241233.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142242260.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111248087.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111259844.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111259083.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111301740.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172251388.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172252419.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172252110.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172240812.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172241026.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172242055.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012121208.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012122139.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130335.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130754.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130351.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211041536330.png">
<meta property="og:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211041541914.png">
<meta property="article:published_time" content="2022-09-30T14:56:43.000Z">
<meta property="article:modified_time" content="2022-11-04T09:25:44.934Z">
<meta property="article:author" content="没有眼的鱼">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302355656.png"><title>NewStar2022wp | 鱼先生的格纳库</title><link ref="canonical" href="https://username.github.io/2022/09/30/NewStar2022wp/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">鱼先生的格纳库</div><div class="header-banner-info__subtitle">没有眼的鱼</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">NewStar2022wp</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-09-30</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-11-04</span></span></div></header><div class="post-body">
        <h1 id="Week-2"   >
          <a href="#Week-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#Week-2" class="headerlink" title="Week 2"></a>Week 2</h1>
      
        <h2 id="FindME"   >
          <a href="#FindME" class="heading-link"><i class="fas fa-link"></i></a><a href="#FindME" class="headerlink" title="FindME"></a>FindME</h2>
      <p>ida64打开</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302355656.png" alt="image-20220930235535614"></p>
<p>打开sub_1BCD函数 发现是一堆return 的函数</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302357832.png" alt="image-20220930235700807"></p>
<p><img src="C:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20220930235756541.png" alt="image-20220930235756541"></p>
<p>找到其中一个有用的函数之后对 s 按 x直接查询交叉引用</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302359126.png" alt="image-20220930235909095"></p>
<p>从下往上执行</p>

        <h2 id="Likemayasp"   >
          <a href="#Likemayasp" class="heading-link"><i class="fas fa-link"></i></a><a href="#Likemayasp" class="headerlink" title="Likemayasp"></a>Likemayasp</h2>
      <p>这题看起来是个ASP壳，但是PE识别的结果是UPX壳</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302302631.png" alt="image-20220930230211565"></p>
<p>可以利用010修改壳头即可用UPX工具破开。当然也可以利用程序在运行的时候自己解壳的特性来动态调试。</p>
<p>ida打开，选择Local Windows debugger</p>
<p>Debugger——Attach to Process——选择需要调试的进程</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302311855.png" alt="image-20220930231158830"></p>
<p>动态调试即可到达加密函数</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302331867.jpg" alt="0564fb81e93b43f34e458c7581381f1"></p>
<p>对密文进行一个长度判断后，位移后4个数一组进行判断</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302332309.jpg" alt="e812521a5b3609e106010eacfd7fda6"></p>
<p>写py脚本解密</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">0x0D803C1FC098</span>, <span class="number">0x0E20360BC097</span>, <span class="number">0x0FE02A1C00A0</span>, <span class="number">0x0FA0121040CB</span>, <span class="number">0x0F2032104092</span>, <span class="number">0x0D6015884082</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">    z = <span class="string">&quot;&quot;</span></span><br><span class="line">    z += <span class="built_in">chr</span>(((i &gt;&gt; <span class="number">37</span>) ^ <span class="number">0xA</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">    z += <span class="built_in">chr</span>((((i &lt;&lt; <span class="number">27</span>) &gt;&gt; <span class="number">50</span>) ^ <span class="number">0x14</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">    z += <span class="built_in">chr</span>((((i &lt;&lt; <span class="number">41</span>) &gt;&gt; <span class="number">55</span>) ^ <span class="number">0x1E</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">    z += <span class="built_in">chr</span>(~(((i &lt;&lt; <span class="number">50</span>) &gt;&gt; <span class="number">50</span>)) &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="built_in">print</span>(z, end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{x1hu@n_w0_4sp_ma??}</p>

        <h2 id="Petals"   >
          <a href="#Petals" class="heading-link"><i class="fas fa-link"></i></a><a href="#Petals" class="headerlink" title="Petals"></a>Petals</h2>
      <p>ida64打开</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302336501.png" alt="image-20220930233632468"></p>
<p>sub_160C是判断函数</p>
<p>sub_1208 + 1无法跳转到函数，查看汇编</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302337828.png" alt="image-20220930233735802"></p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302337343.png" alt="image-20220930233755314"></p>
<p>发现花指令，上面多了一行push rbx</p>
<p>D 变为数据后重新定位</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302338908.png" alt="image-20220930233854879"></p>
<p>不难看出09才是函数的开头</p>
<p>选中后按p定义为函数</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302339783.png" alt="image-20220930233940746"></p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302339262.png" alt="image-20220930233952235"></p>
<p>然而修改后还有红色的，打开汇编再往下看</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302340721.png" alt="image-20220930234022685"></p>
<p>jn jnz 花指令</p>
<p>D 完后 nop掉多余的垃圾数据</p>
<p>一定要nop掉，这两节本来应该是同一个函数，被垃圾数据分割后不仅反汇编错误，还错误的将sub1208识别为void，原本应该是有返回值的。不nop掉会导致前半部分的函数不完整而且使得后半部分的函数的变量无法正常继承。</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302342569.png" alt="image-20220930234247534"></p>
<p>并且将函数的返回值定义为int *</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202209302343811.png" alt="image-20220930234338778"></p>
<p>首先初始化一个v5的数组作为码表，然后再进行替换，逆向的方法选择爆破</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">x = []</span><br><span class="line"><span class="built_in">input</span> = [<span class="number">208</span>, <span class="number">208</span>, <span class="number">133</span>, <span class="number">133</span>, <span class="number">128</span>, <span class="number">128</span>, <span class="number">197</span>, <span class="number">138</span>, <span class="number">147</span>, <span class="number">137</span>,</span><br><span class="line">        <span class="number">146</span>, <span class="number">143</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">159</span>, <span class="number">143</span>, <span class="number">197</span>, <span class="number">132</span>, <span class="number">214</span>, <span class="number">209</span>,</span><br><span class="line">        <span class="number">210</span>, <span class="number">130</span>, <span class="number">211</span>, <span class="number">222</span>, <span class="number">135</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">    x.append(~(i ^ <span class="number">25</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">25</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">input</span>[i] == x[j]):</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment"># 66ccff#luotianyi#b074d58a</span></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(<span class="string">&quot;66ccff#luotianyi#b074d58a&quot;</span>.encode())</span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())</span><br></pre></td></tr></table></div></figure>

<p>flag{d780c9b2d2aa9d40010a753bc15770de}</p>

        <h1 id="Week-3"   >
          <a href="#Week-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#Week-3" class="headerlink" title="Week 3"></a>Week 3</h1>
      
        <h2 id="Zzzzz3333"   >
          <a href="#Zzzzz3333" class="heading-link"><i class="fas fa-link"></i></a><a href="#Zzzzz3333" class="headerlink" title="Zzzzz3333"></a>Zzzzz3333</h2>
      <p>32位IDA</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052031914.png" alt="image-20221005203130856"></p>
<p>用z3解出x，然后再输出</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">x = Ints(<span class="string">f&quot;x<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>))</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(x[<span class="number">3</span>] + <span class="number">4</span> * x[<span class="number">2</span>] + x[<span class="number">7</span>] + <span class="number">4</span> * (x[<span class="number">3</span>] + <span class="number">4</span> * x[<span class="number">2</span>]) + <span class="number">3</span> * (x[<span class="number">4</span>] + <span class="number">4</span> * x[<span class="number">0</span>]) + <span class="number">2</span> * (x[<span class="number">5</span>] + <span class="number">4</span> * x[<span class="number">6</span>]) + <span class="number">11</span> * x[<span class="number">1</span>] == <span class="number">6426</span>)</span><br><span class="line">s.add(<span class="number">11</span> * (x[<span class="number">0</span>] + x[<span class="number">7</span>] + x[<span class="number">3</span>]) + <span class="number">4</span> * (x[<span class="number">5</span>] + <span class="number">2</span> * x[<span class="number">4</span>]) + x[<span class="number">2</span>] + <span class="number">45</span> * x[<span class="number">1</span>] + <span class="number">7</span> * x[<span class="number">6</span>] == <span class="number">9801</span>)</span><br><span class="line">s.add(<span class="number">5</span> * x[<span class="number">1</span>] + <span class="number">2</span> * (x[<span class="number">4</span>] + x[<span class="number">6</span>] + x[<span class="number">5</span>] + <span class="number">2</span> * (x[<span class="number">7</span>] + x[<span class="number">3</span>]) + x[<span class="number">2</span>] + <span class="number">2</span> * (x[<span class="number">6</span>] + x[<span class="number">5</span>] + <span class="number">2</span> * (x[<span class="number">7</span>] + x[<span class="number">3</span>])) + <span class="number">8</span> * x[<span class="number">0</span>]) == <span class="number">6021</span>)</span><br><span class="line">s.add(<span class="number">19</span> * x[<span class="number">0</span>] + <span class="number">9</span> * x[<span class="number">1</span>] + <span class="number">67</span> * x[<span class="number">7</span>] + <span class="number">5</span> * (x[<span class="number">2</span>] + x[<span class="number">6</span>]) + <span class="number">7</span> * (x[<span class="number">5</span>] + <span class="number">4</span> * x[<span class="number">3</span>]) + <span class="number">4</span> * x[<span class="number">4</span>] == <span class="number">14444</span>)</span><br><span class="line">s.add(<span class="number">22</span> * x[<span class="number">5</span>] + <span class="number">5</span> * (x[<span class="number">4</span>] + <span class="number">2</span> * (x[<span class="number">3</span>] + x[<span class="number">1</span>] + <span class="number">2</span> * x[<span class="number">0</span>])) + <span class="number">4</span> * (x[<span class="number">7</span>] + x[<span class="number">6</span>]) + <span class="number">6</span> * x[<span class="number">2</span>] == <span class="number">7251</span>)</span><br><span class="line">s.add(<span class="number">19</span> * x[<span class="number">3</span>] + <span class="number">3</span> * (x[<span class="number">7</span>] + x[<span class="number">2</span>] + <span class="number">4</span> * x[<span class="number">7</span>] + x[<span class="number">6</span>] + <span class="number">2</span> * (x[<span class="number">7</span>] + x[<span class="number">2</span>] + <span class="number">4</span> * x[<span class="number">7</span>])) + <span class="number">4</span> * (x[<span class="number">0</span>] + x[<span class="number">5</span>] + x[<span class="number">1</span>] + <span class="number">2</span> * (x[<span class="number">0</span>] + x[<span class="number">5</span>])) == <span class="number">10054</span>)</span><br><span class="line">s.add(<span class="number">7</span> * x[<span class="number">0</span>] + <span class="number">17</span> * (x[<span class="number">3</span>] + x[<span class="number">1</span>]*<span class="number">2</span>) + <span class="number">11</span> * (x[<span class="number">4</span>] + <span class="number">2</span> * x[<span class="number">5</span>]) + <span class="number">2</span> * (x[<span class="number">2</span>] + x[<span class="number">6</span>] + <span class="number">4</span> * x[<span class="number">2</span>] + <span class="number">6</span> * x[<span class="number">7</span>]) == <span class="number">10735</span>)</span><br><span class="line">s.add(x[<span class="number">6</span>] + x[<span class="number">4</span>] + <span class="number">11</span> * x[<span class="number">2</span>] + <span class="number">15</span> * (x[<span class="number">3</span>] + <span class="number">2</span> * x[<span class="number">7</span>]) + x[<span class="number">1</span>]*<span class="number">2</span> + <span class="number">43</span> * x[<span class="number">0</span>] + <span class="number">21</span> * x[<span class="number">5</span>] == <span class="number">11646</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    result = s.model()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">flag = [<span class="number">102</span>, <span class="number">97</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">119</span>, <span class="number">49</span>, <span class="number">110</span>, <span class="number">100</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i &amp; <span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">y = [</span><br><span class="line">    <span class="number">0</span>,  <span class="number">13</span>,  <span class="number">13</span>,  <span class="number">11</span>,  <span class="number">12</span>, <span class="number">107</span>,  <span class="number">20</span>,  <span class="number">30</span>,  <span class="number">28</span>,  <span class="number">82</span>,</span><br><span class="line">   <span class="number">95</span>,  <span class="number">95</span>,  <span class="number">40</span>, <span class="number">120</span>,  <span class="number">29</span>,  <span class="number">59</span>,  <span class="number">37</span>,  <span class="number">14</span>,   <span class="number">3</span>,   <span class="number">0</span>,</span><br><span class="line">   <span class="number">86</span>,  <span class="number">16</span>,  <span class="number">79</span>,  <span class="number">25</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">24</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((y[i] &amp; (flag[i &amp; <span class="number">7</span>] ^ y[i]) | ~y[i] &amp; (~y[i] ^ ~flag[i &amp; <span class="number">7</span>])) &amp; <span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{Zzzz333_Is_Cool!!!}</p>

        <h2 id="EzTea"   >
          <a href="#EzTea" class="heading-link"><i class="fas fa-link"></i></a><a href="#EzTea" class="headerlink" title="EzTea"></a>EzTea</h2>
      <p>64位ida</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052050170.png" alt="image-20221005205054132"></p>
<p>点开函数，发现是xxtea加密</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052052356.png" alt="image-20221005205253305"></p>
<p>只不过修改了MX和magic值</p>
<p>脚本</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (z&gt;&gt;4^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3 ^ z&lt;&lt;5)^(sum^y) + (k[ i&amp;3 ^ e] ^ z);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="title">btea</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span>* v, <span class="type">long</span> n, <span class="type">unsigned</span> <span class="type">long</span>* k)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> z=v[n<span class="number">-1</span>], y=v[<span class="number">0</span>], sum=<span class="number">0</span>, e, DELTA=<span class="number">0x11451400</span>;</span><br><span class="line">    <span class="type">long</span> i, q ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;         </span><br><span class="line">        q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sum += DELTA;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;n<span class="number">-1</span>; i++)&#123; </span><br><span class="line">            y = v[i+<span class="number">1</span>];</span><br><span class="line">            z = v[i] += MX;</span><br><span class="line">        &#125; </span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125; </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123; </span><br><span class="line">        n = -n;</span><br><span class="line">        q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = q*DELTA ;</span><br><span class="line">        <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (i=n<span class="number">-1</span>; i&gt;<span class="number">0</span>; i--) &#123;</span><br><span class="line">            z = v[i<span class="number">-1</span>];</span><br><span class="line">            y = v[i] -= MX;   </span><br><span class="line">        &#125;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">        sum -= DELTA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> key[] = &#123;<span class="number">0x19</span>, <span class="number">0x19</span>, <span class="number">0x08</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> EntryData[] = &#123;<span class="number">0x38FA8A82</span>, <span class="number">0x0D7501380</span>, <span class="number">0x0E40969D</span>, <span class="number">0x4E169120</span>, <span class="number">0x713A29AB</span>,</span><br><span class="line">                        <span class="number">0x6CE5393D</span>, <span class="number">0x0B69D752E</span>, <span class="number">0x841A88E6</span>, <span class="number">0x6F31B459</span> &#125;;</span><br><span class="line">    <span class="built_in">btea</span>(EntryData, <span class="number">-9</span>, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">9</span>; j++) &#123;                        </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, EntryData[j] &amp; <span class="number">0xff</span>);</span><br><span class="line">                EntryData[j] &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>flag{H0P3_U_L1k3_Th15_CUP_0f_TEa.}</p>

        <h2 id="The-Slider’s-Labyrinth"   >
          <a href="#The-Slider’s-Labyrinth" class="heading-link"><i class="fas fa-link"></i></a><a href="#The-Slider’s-Labyrinth" class="headerlink" title="The Slider’s Labyrinth"></a>The Slider’s Labyrinth</h2>
      <p>32位ida</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052256416.png" alt="image-20221005225658352"></p>
<p>这里加了好几个花指令</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052257088.png" alt="image-20221005225718061"></p>
<p>主要都是这种死循环的，直接nop</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052300048.png" alt="image-20221005230022013"></p>
<p>还是红的，再将hlt给nop掉</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052301365.png" alt="image-20221005230104334"></p>
<p>于是就能正常显示了</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052301734.png" alt="image-20221005230124689"></p>
<p>分析过程</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052302681.png" alt="image-20221005230243637"></p>
<p>发现将输入减掉97后四个case，即w a s d控制上下左右，while循环让人物一直走到墙才停止，并且每行的长度是16</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052304318.png" alt="image-20221005230422289"></p>
<p>找到地图</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052304238.png" alt="image-20221005230455193"></p>
<p>大概就长这样</p>
<div class="table-container"><table>
<thead>
<tr>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
<th>#</th>
</tr>
</thead>
<tbody><tr>
<td>#</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>#</td>
<td></td>
<td>O</td>
<td>#</td>
</tr>
<tr>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
<td>#</td>
</tr>
</tbody></table></div>
<p>走法不唯一，题目要求的是最短的一条</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052308550.png" alt="image-20221005230823504"></p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210052308108.png" alt="image-20221005230831060"></p>
<p>flag{f71516bdf07abd7bc0668db9d6352364}</p>

        <h2 id="Annnnnnggrr"   >
          <a href="#Annnnnnggrr" class="heading-link"><i class="fas fa-link"></i></a><a href="#Annnnnnggrr" class="headerlink" title="Annnnnnggrr"></a>Annnnnnggrr</h2>
      <p>本题主要考察angr的使用</p>
<p>ida无壳</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142259051.png" alt="image-20221014225958996"></p>
<p><del>大哥爬楼梯</del></p>
<p>没什么好说的，基本上就是对着angr的模板写就行</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line">proj = angr.Project(<span class="string">&quot;./Annnnnggrr.exe&quot;</span>, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line">star = <span class="number">0x140001103</span> <span class="comment"># 跳过输入</span></span><br><span class="line">state = proj.factory.blank_state(addr=star)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">password = claripy.BVS(<span class="string">&quot;password&quot;</span>, <span class="number">32</span> * <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ans = <span class="number">0x140005640</span></span><br><span class="line">state.memory.store(ans, password)</span><br><span class="line"></span><br><span class="line">simg = proj.factory.simulation_manager(state)</span><br><span class="line">check_addr = <span class="number">0x14000248A</span></span><br><span class="line">simg.explore(find = check_addr)</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x4F</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x56</span>, <span class="number">0xDB</span>, <span class="number">0x67</span>, <span class="number">0x5D</span>, <span class="number">0x67</span>,</span><br><span class="line">       <span class="number">0x32</span>, <span class="number">0x2B</span>, <span class="number">0x36</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0xF3</span>, <span class="number">0xA1</span>, <span class="number">0xE4</span>,</span><br><span class="line">       <span class="number">0xC7</span>, <span class="number">0x27</span>, <span class="number">0xC1</span>, <span class="number">0xB6</span>, <span class="number">0x4C</span>, <span class="number">0xD7</span>, <span class="number">0x59</span>, <span class="number">0xA1</span>,</span><br><span class="line">       <span class="number">0x71</span>, <span class="number">0x52</span>, <span class="number">0x9A</span>, <span class="number">0xE2</span>, <span class="number">0x21</span>, <span class="number">0x96</span>, <span class="number">0x0C</span>, <span class="number">0xCA</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> simg.found:</span><br><span class="line">    check_state = simg.found[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        ch = check_state.memory.load(ans + i, <span class="number">1</span>)</span><br><span class="line">        check_state.solver.add(ch == key[i]) <span class="comment"># 添加约束条件</span></span><br><span class="line"></span><br><span class="line">    sol = check_state.solver.<span class="built_in">eval</span>(password, cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">    <span class="built_in">print</span>(sol)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not Solution&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{umm_I_can‘t_calc_1t_@t_all}</p>

        <h2 id="funnyOTL-1"   >
          <a href="#funnyOTL-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#funnyOTL-1" class="headerlink" title="funnyOTL_1"></a>funnyOTL_1</h2>
      <p>ida64位</p>
<p>这题主要是对c++的库函数的熟悉度</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142304500.png" alt="image-20221014230455452"></p>
<p>输入<code>flag&#123;&#125;</code>包裹的总长为24位的密码</p>
<p><img src="C:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20221014230607425.png" alt="image-20221014230607425"></p>
<p>然后就是加密后交换，唯一问题是这个随机数的问题，经过测试，Linux环境下随机数的值和Windows下是不一样的，以后要注意系统之间的差异</p>
<p>写脚本</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">enc =[ <span class="number">76</span>, <span class="number">171</span>, <span class="number">120</span>,  <span class="number">73</span>, <span class="number">104</span>, <span class="number">157</span>,  <span class="number">81</span>, <span class="number">121</span>, <span class="number">117</span>,  <span class="number">95</span>,</span><br><span class="line">    <span class="number">125</span>, <span class="number">197</span>,  <span class="number">99</span>,  <span class="number">82</span>,  <span class="number">76</span>, <span class="number">180</span>,  <span class="number">79</span>, <span class="number">123</span>, <span class="number">103</span>,  <span class="number">97</span>,</span><br><span class="line">    <span class="number">111</span>, <span class="number">110</span>, <span class="number">107</span>,  <span class="number">95</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x12</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0xa</span>,<span class="number">0x6</span>,<span class="number">0x14</span>,<span class="number">0xa</span>,<span class="number">0x14</span>,<span class="number">0</span>,<span class="number">0xc</span>,<span class="number">0x2</span>,<span class="number">0x4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    sec1 = enc[i*<span class="number">2</span>]</span><br><span class="line">    sec2 = enc[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    fir1 = enc[key[i]]</span><br><span class="line">    fir2 = enc[key[i] + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fir1 = fir1 ^ key[i]</span><br><span class="line">    fir2 = (~fir2) ^ key[i]</span><br><span class="line"></span><br><span class="line">    enc[i*<span class="number">2</span>] = fir1</span><br><span class="line">    enc[i*<span class="number">2</span>+<span class="number">1</span>] = fir2</span><br><span class="line"></span><br><span class="line">    enc[key[i]] = sec1</span><br><span class="line">    enc[key[i] + <span class="number">1</span>] = sec2</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    s = <span class="built_in">chr</span>(i &amp; <span class="number">0xff</span>) + s</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></div></figure>

<p>flag{OTL_n0w_u_know_STL}</p>

        <h1 id="Week4"   >
          <a href="#Week4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1>
      
        <h2 id="Hash"   >
          <a href="#Hash" class="heading-link"><i class="fas fa-link"></i></a><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">enc = [</span><br><span class="line">    <span class="string">&#x27;a2f17ed1c6a8bc31769cdf654df4b8a937042cb6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0ca8a2edb0c1d34a432a5a4464e0d6abd847c831&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c359d69f3f08bb920f2c3b51133205533462093e&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cc5c3fe6e7356a26a134cff5633349f597c40a9d&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4ac4bb3f27f245ba9178651aa5cdedcbb2862e2a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a01e33f4dcdb6ba1ae9f34a97cf8f6deeedf1a8d&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d3af70912a8c1b22cfdece071ba36bc4662b58fa&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9395eab195d25b676d7d07075d3838a9ac19df21&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;fdb43c5ef76ecda0c1661d6d199b5bfac1db538a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;da8e9997a010be78b20108ce79fec1fb9c63d8dc&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;809da627f1ad01d65864c376e3179b62d9d74261&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8f61ee21ac7579626934e0ffb6a62b3d4a82eec4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;e2a954758fdb61f869998e9788b7b7e48480b832&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b8e3349b97532b27aa62b8718b68240179158144&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">            <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">                ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                ans = ans + <span class="built_in">chr</span>(x&amp;<span class="number">0xff</span>) + <span class="built_in">chr</span>(y&amp;<span class="number">0xff</span>) + <span class="built_in">chr</span>(z&amp;<span class="number">0xff</span>)</span><br><span class="line">                m = hashlib.sha1()</span><br><span class="line">                m.update(ans.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">if</span> m.hexdigest() == enc[i]:</span><br><span class="line">                    flag = flag + ans</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></div></figure>

<p>flag{Easy_Hash_And_Y0u_Solve_1t_Quickly!!}</p>

        <h2 id="Exception"   >
          <a href="#Exception" class="heading-link"><i class="fas fa-link"></i></a><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h2>
      <p>32位ida</p>
<p><img src="C:/Users/74592/AppData/Roaming/Typora/typora-user-images/image-20221014223810878.png" alt="image-20221014223810878"></p>
<p>乍一看只是单纯的tea，但是直接逆是解不出来的</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142239382.png" alt="image-20221014223948342"></p>
<p>在tea加密里面塞入了一个try块</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142240132.png" alt="image-20221014224033090"></p>
<p>分析异常，发现异常过滤器的返回值恒为1，即一定进入异常处理</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142241233.png" alt="image-20221014224158198"></p>
<p>于是直接分析异常处理</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210142242260.png" alt="image-20221014224231224"></p>
<p>这里将delta 异或了一个0x12345678，编写脚本</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span>* EntryData, <span class="type">unsigned</span> <span class="type">long</span>* Key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> Mup = EntryData[<span class="number">0</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> Mdown = EntryData[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line"> 	<span class="type">int</span> n=<span class="number">32</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算delta最后的值</span></span><br><span class="line">   	<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j++)&#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        delta ^= <span class="number">0x12345678</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        Mdown -= ((Mup &lt;&lt; <span class="number">4</span>) + Key[<span class="number">2</span>]) ^ (Mup + sum) ^ ((Mup &gt;&gt; <span class="number">5</span>) + Key[<span class="number">3</span>]);</span><br><span class="line">        Mup -= ((Mdown &lt;&lt; <span class="number">4</span>) + Key[<span class="number">0</span>]) ^ (Mdown + sum) ^ ((Mdown &gt;&gt; <span class="number">5</span>) + Key[<span class="number">1</span>]);</span><br><span class="line">        delta ^= <span class="number">0x12345678</span>;<span class="comment">//每次循环将delta异或后再减</span></span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    EntryData[<span class="number">0</span>] = Mup;</span><br><span class="line">    EntryData[<span class="number">1</span>] = Mdown;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> key[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flag[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">206</span>,  <span class="number">33</span>, <span class="number">232</span>, <span class="number">136</span>, <span class="number">112</span>, <span class="number">157</span>,   <span class="number">0</span>,  <span class="number">11</span>, <span class="number">143</span>, <span class="number">230</span>, </span><br><span class="line">  <span class="number">177</span>, <span class="number">145</span>, <span class="number">150</span>, <span class="number">234</span>,  <span class="number">49</span>,   <span class="number">1</span>, <span class="number">125</span>, <span class="number">157</span>,  <span class="number">32</span>, <span class="number">163</span>, </span><br><span class="line">  <span class="number">251</span>, <span class="number">125</span>,  <span class="number">24</span>, <span class="number">169</span>, <span class="number">202</span>, <span class="number">197</span>,  <span class="number">82</span>, <span class="number">196</span>,  <span class="number">83</span>, <span class="number">103</span>, </span><br><span class="line">  <span class="number">105</span>, <span class="number">169</span></span><br><span class="line">&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i+=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decrypt</span>((<span class="type">unsigned</span> <span class="type">long</span> *)&amp;flag[i*<span class="number">4</span>],key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;flag[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>flag{44C3A7F112DA2BE728F451C5E2D09558}</p>

        <h2 id="HelpMe"   >
          <a href="#HelpMe" class="heading-link"><i class="fas fa-link"></i></a><a href="#HelpMe" class="headerlink" title="HelpMe"></a>HelpMe</h2>
      <p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111248087.png" alt="image-20221011124833051"></p>
<p>解压后发现有一个ps1的owershell的脚本文件</p>
<p>题目的意思是一个excel文件被加密了</p>
<p>.enc是一个二进制文件，突破点在于Help.ps1脚本</p>
<figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mypath</span> = <span class="built_in">Split-Path</span> <span class="literal">-Parent</span> <span class="variable">$MyInvocation</span>.MyCommand.Definition</span><br><span class="line">&amp;([<span class="type">scriptblock</span>]::create((<span class="built_in">New-Object</span> System.IO.StreamReader(<span class="built_in">New-Object</span> System.IO.Compression.GzipStream((<span class="built_in">New-Object</span> System.IO.MemoryStream(,[<span class="type">System.Convert</span>]::FromBase64String(<span class="string">&#x27;H4sIAKxePWMA/31RT2+bMBS/8yksxAHUYCVI66RMm5TQdJq6LFXJdslycPGDeDU2wi9a0LTv3mdos2yHXZDfD//++UWoGnAompa9Z/HuRiBsCdlUlQPcxx8BU4+xsBDINiWy6Yxl0yyjzzzL5tksTBK+tV+NOnleAaU10sVJED1BT5Jf4Ge6efwBxFz2CLs9m10HXvVBGGkblq7FiWVvrllaABYAkl0k+hCZo9ZBZTsWR8pIOJHi9B17OacaSe11vLpK2C/vuhvnPd3dPZLn2OIfv+R3EC1Wxd8Ji94hNJxKHDuFPc+7vkVbd6I99HwBbi2MqEEOTH439POG47y2EggIV/kyHJF7IaUytc/xX+WXe15gP5/f3+XF2yCqlB7koqZvBR6+N32tKuQn7RqS973chfCnDb8lAtEfQMiF1v6xXRwOMiFtY2XKwbLzmX24vAPa6xn2GwNTSoHC3zjjfNsJ42gDza0yQi+1LZ/i0X7CphM2HvlnMDUeLn34jXKtdeCFvd+fkRad5tYgGGTpN6GPwM7WKfHt8Gi+ALX3+Tn9DYNn5mIx06oCAAA=&#x27;</span>))),[<span class="type">System.IO.Compression.CompressionMode</span>]::Decompress))).ReadToEnd()))</span><br></pre></td></tr></table></div></figure>

<p>真正的脚本应该是那段base64数据，python解密后再用gzip解压（这个是看网上那些恶意代码分析的文章看来了）</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line">text = <span class="string">&quot;H4sIAKxePWMA/31RT2+bMBS/8yksxAHUYCVI66RMm5TQdJq6LFXJdslycPGDeDU2wi9a0LTv3mdos2yHXZDfD//++UWoGnAompa9Z/HuRiBsCdlUlQPcxx8BU4+xsBDINiWy6Yxl0yyjzzzL5tksTBK+tV+NOnleAaU10sVJED1BT5Jf4Ge6efwBxFz2CLs9m10HXvVBGGkblq7FiWVvrllaABYAkl0k+hCZo9ZBZTsWR8pIOJHi9B17OacaSe11vLpK2C/vuhvnPd3dPZLn2OIfv+R3EC1Wxd8Ji94hNJxKHDuFPc+7vkVbd6I99HwBbi2MqEEOTH439POG47y2EggIV/kyHJF7IaUytc/xX+WXe15gP5/f3+XF2yCqlB7koqZvBR6+N32tKuQn7RqS973chfCnDb8lAtEfQMiF1v6xXRwOMiFtY2XKwbLzmX24vAPa6xn2GwNTSoHC3zjjfNsJ42gDza0yQi+1LZ/i0X7CphM2HvlnMDUeLn34jXKtdeCFvd+fkRad5tYgGGTpN6GPwM7WKfHt8Gi+ALX3+Tn9DYNn5mIx06oCAAA=&quot;</span></span><br><span class="line"><span class="built_in">print</span>(gzip.decompress(base64.b64decode(text)).decode())</span><br></pre></td></tr></table></div></figure>

<p>跑完就会出现真正的脚本</p>
<figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$timestamp</span> = ([<span class="built_in">DateTime</span><span class="type">Offset</span>](<span class="built_in">Get-Date</span> <span class="string">&quot;Sat Oct 01 2022 20:22:21&quot;</span>)).ToUnixTimeSeconds()</span><br><span class="line"><span class="variable">$key</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">16</span></span><br><span class="line"><span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span> <span class="literal">-SetSeed</span> <span class="variable">$timestamp</span> &gt;<span class="variable">$null</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$index</span> = <span class="number">0</span>; <span class="variable">$index</span> <span class="operator">-lt</span> <span class="number">16</span>; <span class="variable">$index</span>++) &#123;<span class="variable">$key</span>[<span class="variable">$index</span>] = [<span class="built_in">byte</span>](<span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span>)&#125;</span><br><span class="line"><span class="variable">$AES</span> = <span class="built_in">New-Object</span> System.Security.Cryptography.AesManaged</span><br><span class="line"><span class="variable">$AES</span>.Key = <span class="variable">$key</span></span><br><span class="line"><span class="variable">$AES</span>.Mode = <span class="string">&quot;ECB&quot;</span></span><br><span class="line"><span class="variable">$AES</span>.Padding = [<span class="type">System.Security.Cryptography.PaddingMode</span>]::PKCS7</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;<span class="variable">$mypath</span>\mygift.xlsm&quot;</span></span><br><span class="line"><span class="variable">$bytes</span> = [<span class="type">System.IO.File</span>]::ReadAllBytes(<span class="string">&quot;<span class="variable">$file</span>&quot;</span>)</span><br><span class="line"><span class="variable">$Encryptor</span> = <span class="variable">$AES</span>.CreateEncryptor()</span><br><span class="line"><span class="variable">$encdata</span> = <span class="variable">$Encryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length)</span><br><span class="line"><span class="variable">$Encryptor</span>.Dispose()</span><br><span class="line"><span class="variable">$AES</span>.Dispose()</span><br><span class="line"><span class="built_in">Set-Content</span> <span class="literal">-Value</span> <span class="variable">$encdata</span> <span class="literal">-Encoding</span> Byte <span class="string">&quot;<span class="variable">$file</span>.enc&quot;</span></span><br></pre></td></tr></table></div></figure>

<p>首先用<code>Sat Oct 01 2022 20:22:21</code>生成16位随机数，然后再AES的ECB模式加密文件</p>
<p>首先写脚本，用powershell跑出key</p>
<figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$timestamp</span> = ([<span class="built_in">DateTime</span><span class="type">Offset</span>](<span class="built_in">Get-Date</span> <span class="string">&quot;Sat Oct 01 2022 20:22:21&quot;</span>)).ToUnixTimeSeconds()</span><br><span class="line"><span class="variable">$key</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">16</span></span><br><span class="line"><span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span> <span class="literal">-SetSeed</span> <span class="variable">$timestamp</span> &gt;<span class="variable">$null</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$index</span> = <span class="number">0</span>; <span class="variable">$index</span> <span class="operator">-lt</span> <span class="number">16</span>; <span class="variable">$index</span>++) &#123;<span class="variable">$key</span>[<span class="variable">$index</span>] = [<span class="built_in">byte</span>](<span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$index</span> = <span class="number">0</span>; <span class="variable">$index</span> <span class="operator">-lt</span> <span class="number">16</span>; <span class="variable">$index</span>++) &#123;</span><br><span class="line">	<span class="built_in">Write-Host</span> <span class="variable">$key</span>[<span class="variable">$index</span>]</span><br><span class="line">	<span class="built_in">Write-Host</span> <span class="string">&quot;,&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = [<span class="number">105</span>, <span class="number">192</span>, <span class="number">50</span>, <span class="number">118</span>, <span class="number">175</span>, <span class="number">152</span>, <span class="number">128</span>, <span class="number">155</span>, <span class="number">147</span>, <span class="number">80</span>, <span class="number">183</span>, <span class="number">37</span>, <span class="number">190</span>, <span class="number">22</span>, <span class="number">242</span>, <span class="number">78</span>]</span><br><span class="line">key = <span class="string">b&#x27;i\xc02v\xaf\x98\x80\x9b\x93P\xb7%\xbe\x16\xf2N&#x27;</span></span><br></pre></td></tr></table></div></figure>

<p>然后AES对mygift.xlsm.gift文件进行解密</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\74592\\Desktop\\NewStarCTF2022\\week4\\HelpMe\\mygift.xlsm.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">data = file.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;i\xc02v\xaf\x98\x80\x9b\x93P\xb7%\xbe\x16\xf2N&#x27;</span></span><br><span class="line"></span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">out = aes.decrypt(data)</span><br><span class="line"></span><br><span class="line">file2 = <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\74592\\Desktop\\NewStarCTF2022\\week4\\HelpMe\\ans.xls&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">file2.write(out)</span><br></pre></td></tr></table></div></figure>

<p>然后就会生成一个ans.xls文件。题目说是excel工作表就直接加.xls上去了</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111259844.png" alt="image-20221011125910800"></p>
<p>但是文件损坏了，用在线xls修复工具修复后再打开</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111259083.png" alt="image-20221011125948035"></p>
<p>出现一个数组并且有个宏，猜测有可能是宏里面写了什么东西，Alt + F11打开vba编辑器，发现加密的代码</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210111301740.png" alt="image-20221011130105675"></p>
<p>大意是将excel里面是数组按照arr数组里面的顺序和x异或，然后<code>x = (a * x + b) % 255</code>，脚本解密</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">enc = [ <span class="number">62</span>, <span class="number">163</span>, <span class="number">115</span>, <span class="number">241</span>, <span class="number">149</span>,	<span class="number">89</span>,	<span class="number">216</span>,  <span class="number">45</span>,</span><br><span class="line">        <span class="number">20</span>, <span class="number">138</span>, <span class="number">220</span>,   <span class="number">8</span>,	<span class="number">75</span>,	<span class="number">42</span>, <span class="number">135</span>,  <span class="number">93</span>,</span><br><span class="line">       <span class="number">161</span>,  <span class="number">60</span>, <span class="number">115</span>, <span class="number">215</span>, <span class="number">169</span>,	<span class="number">66</span>,  <span class="number">32</span>, <span class="number">132</span>,</span><br><span class="line">       <span class="number">141</span>,  <span class="number">21</span>, <span class="number">184</span>,  <span class="number">95</span>, <span class="number">159</span>,  <span class="number">3</span>,	<span class="number">121</span>,  <span class="number">91</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr = [   <span class="number">2</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">18</span>, <span class="number">15</span>,</span><br><span class="line">          <span class="number">5</span>,  <span class="number">0</span>,  <span class="number">6</span>, <span class="number">23</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">9</span>,</span><br><span class="line">          <span class="number">7</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">12</span>,  <span class="number">1</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">31</span>,</span><br><span class="line">         <span class="number">27</span>, <span class="number">25</span>,  <span class="number">3</span>, <span class="number">28</span>,  <span class="number">8</span>, <span class="number">22</span>, <span class="number">17</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">a = <span class="number">20</span></span><br><span class="line">b = <span class="number">22</span></span><br><span class="line">x = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    tmp = enc[arr[i]]</span><br><span class="line">    tmp = tmp ^ x</span><br><span class="line">    x = (a * x + b) % <span class="number">255</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(tmp&amp;<span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{This_is_@_begin_about@hack}</p>

        <h1 id="Week5"   >
          <a href="#Week5" class="heading-link"><i class="fas fa-link"></i></a><a href="#Week5" class="headerlink" title="Week5"></a>Week5</h1>
      
        <h2 id="拔丝溜肆"   >
          <a href="#拔丝溜肆" class="heading-link"><i class="fas fa-link"></i></a><a href="#拔丝溜肆" class="headerlink" title="拔丝溜肆"></a>拔丝溜肆</h2>
      <p>64位ida无壳</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172251388.png" alt="image-20221017225121337"></p>
<p>记住这个<code>srand(114514)</code></p>
<p>点进base64plus函数</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172252419.png" alt="image-20221017225219365"></p>
<p>发现在基本的base64上还多了个函数</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172252110.png" alt="image-20221017225240067"></p>
<p>这里每次循环都生成一个随机数然后让key，即码表整体向右循环位移</p>
<p>随机数种子则是之前出现过的114514</p>
<p>写脚本得出随机数</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="number">114514</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">14</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d, &quot;</span>, <span class="built_in">rand</span>()%<span class="number">64</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// randnum = &#123;41, 40, 57, 10, 62, 30, 59, 25, 12, 0, 46, 58, 1, 24&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>然后只要在base64解码的时候加入码表移动就好了</p>
<p><del>当然也可以解码14次只取对应位置的三个字符</del></p>
<p>flag{12573882-1CF1-EB5E-C965-035B1F263C38}</p>

        <h2 id="E4sy-Mix"   >
          <a href="#E4sy-Mix" class="heading-link"><i class="fas fa-link"></i></a><a href="#E4sy-Mix" class="headerlink" title="E4sy_Mix"></a>E4sy_Mix</h2>
      <p>ida32位无壳</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172240812.png" alt="image-20221017224048755"></p>
<p>SMC自修改，使用idc脚本</p>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;idc.idc&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> addr = <span class="number">0x402000</span>;</span><br><span class="line">    <span class="keyword">auto</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">53</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">PatchByte</span>(addr+i,<span class="built_in">Byte</span>(addr+i)^<span class="number">0x54</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172241026.png" alt="image-20221017224154988"></p>
<p>分析之后发现第一个函数只是单纯的初始化一个key数组</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202210172242055.png" alt="image-20221017224238012"></p>
<p>下断点动调后对着抄跑一边就行了</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">flag = [</span><br><span class="line"> <span class="number">161</span>, <span class="number">191</span>, <span class="number">182</span>, <span class="number">112</span>,  <span class="number">99</span>,  <span class="number">91</span>,  <span class="number">59</span>, <span class="number">237</span>, <span class="number">244</span>, <span class="number">145</span>,</span><br><span class="line">  <span class="number">129</span>, <span class="number">164</span>, <span class="number">189</span>,  <span class="number">58</span>,  <span class="number">83</span>, <span class="number">134</span>,  <span class="number">91</span>, <span class="number">140</span>, <span class="number">219</span>,  <span class="number">65</span>,</span><br><span class="line">   <span class="number">27</span>, <span class="number">115</span>, <span class="number">225</span>, <span class="number">209</span>, <span class="number">242</span>, <span class="number">178</span>, <span class="number">223</span>, <span class="number">110</span>,  <span class="number">22</span>,  <span class="number">86</span>,</span><br><span class="line">   <span class="number">34</span>,  <span class="number">66</span>, <span class="number">252</span>]</span><br><span class="line"></span><br><span class="line">key = [</span><br><span class="line">    <span class="number">97</span>, <span class="number">7</span>, <span class="number">213</span>, <span class="number">138</span>, <span class="number">105</span>, <span class="number">120</span>, <span class="number">45</span>, <span class="number">86</span>, <span class="number">209</span>, <span class="number">124</span>,</span><br><span class="line">    <span class="number">30</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">100</span>, <span class="number">48</span>, <span class="number">20</span>, <span class="number">197</span>, <span class="number">60</span>, <span class="number">176</span>,</span><br><span class="line">    <span class="number">55</span>, <span class="number">65</span>, <span class="number">28</span>, <span class="number">23</span>, <span class="number">106</span>, <span class="number">181</span>, <span class="number">74</span>, <span class="number">185</span>, <span class="number">61</span>, <span class="number">77</span>,</span><br><span class="line">    <span class="number">242</span>, <span class="number">183</span>, <span class="number">56</span>, <span class="number">184</span>, <span class="number">123</span>, <span class="number">159</span>, <span class="number">72</span>, <span class="number">127</span>, <span class="number">229</span>, <span class="number">210</span>,</span><br><span class="line">    <span class="number">168</span>, <span class="number">238</span>, <span class="number">179</span>, <span class="number">47</span>, <span class="number">193</span>, <span class="number">90</span>, <span class="number">206</span>, <span class="number">11</span>, <span class="number">42</span>, <span class="number">148</span>,</span><br><span class="line">    <span class="number">80</span>, <span class="number">202</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">169</span>, <span class="number">225</span>, <span class="number">103</span>, <span class="number">222</span>, <span class="number">40</span>, <span class="number">118</span>,</span><br><span class="line">    <span class="number">49</span>, <span class="number">9</span>, <span class="number">62</span>, <span class="number">226</span>, <span class="number">63</span>, <span class="number">167</span>, <span class="number">32</span>, <span class="number">254</span>, <span class="number">38</span>, <span class="number">66</span>,</span><br><span class="line">    <span class="number">122</span>, <span class="number">217</span>, <span class="number">76</span>, <span class="number">214</span>, <span class="number">99</span>, <span class="number">35</span>, <span class="number">52</span>, <span class="number">195</span>, <span class="number">8</span>, <span class="number">146</span>,</span><br><span class="line">    <span class="number">171</span>, <span class="number">24</span>, <span class="number">145</span>, <span class="number">59</span>, <span class="number">173</span>, <span class="number">26</span>, <span class="number">78</span>, <span class="number">165</span>, <span class="number">240</span>, <span class="number">131</span>,</span><br><span class="line">    <span class="number">182</span>, <span class="number">5</span>, <span class="number">119</span>, <span class="number">199</span>, <span class="number">198</span>, <span class="number">142</span>, <span class="number">144</span>, <span class="number">93</span>, <span class="number">25</span>, <span class="number">109</span>,</span><br><span class="line">    <span class="number">51</span>, <span class="number">27</span>, <span class="number">248</span>, <span class="number">69</span>, <span class="number">172</span>, <span class="number">154</span>, <span class="number">150</span>, <span class="number">166</span>, <span class="number">121</span>, <span class="number">192</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">2</span>, <span class="number">219</span>, <span class="number">83</span>, <span class="number">104</span>, <span class="number">107</span>, <span class="number">16</span>, <span class="number">111</span>, <span class="number">152</span>, <span class="number">223</span>,</span><br><span class="line">    <span class="number">132</span>, <span class="number">10</span>, <span class="number">71</span>, <span class="number">64</span>, <span class="number">19</span>, <span class="number">243</span>, <span class="number">175</span>, <span class="number">18</span>, <span class="number">186</span>, <span class="number">139</span>,</span><br><span class="line">    <span class="number">215</span>, <span class="number">203</span>, <span class="number">155</span>, <span class="number">246</span>, <span class="number">200</span>, <span class="number">156</span>, <span class="number">224</span>, <span class="number">1</span>, <span class="number">91</span>, <span class="number">227</span>,</span><br><span class="line">    <span class="number">162</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">218</span>, <span class="number">46</span>, <span class="number">117</span>, <span class="number">194</span>, <span class="number">116</span>, <span class="number">221</span>, <span class="number">251</span>,</span><br><span class="line">    <span class="number">253</span>, <span class="number">234</span>, <span class="number">161</span>, <span class="number">129</span>, <span class="number">187</span>, <span class="number">101</span>, <span class="number">37</span>, <span class="number">68</span>, <span class="number">216</span>, <span class="number">36</span>,</span><br><span class="line">    <span class="number">57</span>, <span class="number">191</span>, <span class="number">87</span>, <span class="number">13</span>, <span class="number">236</span>, <span class="number">112</span>, <span class="number">252</span>, <span class="number">189</span>, <span class="number">89</span>, <span class="number">75</span>,</span><br><span class="line">    <span class="number">73</span>, <span class="number">134</span>, <span class="number">205</span>, <span class="number">231</span>, <span class="number">115</span>, <span class="number">160</span>, <span class="number">141</span>, <span class="number">29</span>, <span class="number">220</span>, <span class="number">94</span>,</span><br><span class="line">    <span class="number">151</span>, <span class="number">135</span>, <span class="number">201</span>, <span class="number">204</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">128</span>, <span class="number">22</span>, <span class="number">188</span>, <span class="number">211</span>,</span><br><span class="line">    <span class="number">235</span>, <span class="number">244</span>, <span class="number">88</span>, <span class="number">81</span>, <span class="number">67</span>, <span class="number">249</span>, <span class="number">207</span>, <span class="number">190</span>, <span class="number">241</span>, <span class="number">102</span>,</span><br><span class="line">    <span class="number">212</span>, <span class="number">247</span>, <span class="number">4</span>, <span class="number">95</span>, <span class="number">33</span>, <span class="number">237</span>, <span class="number">50</span>, <span class="number">174</span>, <span class="number">21</span>, <span class="number">39</span>,</span><br><span class="line">    <span class="number">239</span>, <span class="number">44</span>, <span class="number">233</span>, <span class="number">54</span>, <span class="number">250</span>, <span class="number">92</span>, <span class="number">41</span>, <span class="number">147</span>, <span class="number">53</span>, <span class="number">149</span>,</span><br><span class="line">    <span class="number">232</span>, <span class="number">163</span>, <span class="number">82</span>, <span class="number">110</span>, <span class="number">143</span>, <span class="number">180</span>, <span class="number">228</span>, <span class="number">157</span>, <span class="number">170</span>, <span class="number">98</span>,</span><br><span class="line">    <span class="number">58</span>, <span class="number">164</span>, <span class="number">208</span>, <span class="number">79</span>, <span class="number">140</span>, <span class="number">70</span>, <span class="number">34</span>, <span class="number">178</span>, <span class="number">177</span>, <span class="number">137</span>,</span><br><span class="line">    <span class="number">85</span>, <span class="number">158</span>, <span class="number">255</span>, <span class="number">17</span>, <span class="number">196</span>, <span class="number">43</span>, <span class="number">31</span>, <span class="number">230</span>, <span class="number">108</span>, <span class="number">133</span>,</span><br><span class="line">    <span class="number">96</span>, <span class="number">245</span>, <span class="number">153</span>, <span class="number">136</span>, <span class="number">130</span>, <span class="number">84</span>]</span><br><span class="line"></span><br><span class="line">v4 = <span class="number">0</span></span><br><span class="line">v3 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">33</span>):</span><br><span class="line">    v3 = (v3 + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    v5 = key[v3]</span><br><span class="line">    v4 = (v5 + v4) % <span class="number">256</span></span><br><span class="line">    key[v3] = key[v4]</span><br><span class="line">    key[v4] = v5</span><br><span class="line">    flag[i] ^= key[(v5 + key[v3]) % <span class="number">256</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i]&amp;<span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{RC4_and_SMC_is_interesting!}</p>

        <h2 id="Petals-Level-Up"   >
          <a href="#Petals-Level-Up" class="heading-link"><i class="fas fa-link"></i></a><a href="#Petals-Level-Up" class="headerlink" title="Petals Level Up"></a>Petals Level Up</h2>
      <p> 这道题的关键在于花指令</p>
<p>64位无壳</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012121208.png" alt="image-20221101212138136"></p>
<p>很明显有花指令</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012122139.png" alt="image-20221101212217081"></p>
<p>很明显，最后跳转的地址等于0x1755 + (0xcd ^ 0xc4) = 0x175e</p>
<p>然后将0x173a 到  0x175c这段给nop掉</p>
<p>类似的还有几个</p>
<p>最后应该是</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130335.png" alt="image-20221101213002285"></p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130754.png"></p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211012130351.png" alt="image-20221101213044304"></p>
<p>写出脚本</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="built_in">len</span> = <span class="number">32</span></span><br><span class="line">key = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    key[i] = (~(i ^ <span class="built_in">len</span>)) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0xB3</span>, <span class="number">0x79</span>, <span class="number">0xF1</span>, <span class="number">0x70</span>, <span class="number">0xB3</span>, <span class="number">0x79</span>, <span class="number">0xF1</span>, <span class="number">0x70</span>, <span class="number">0xB3</span>, <span class="number">0x31</span>,</span><br><span class="line">  <span class="number">0xC3</span>, <span class="number">0x6E</span>, <span class="number">0x24</span>, <span class="number">0xE3</span>, <span class="number">0x7C</span>, <span class="number">0xFF</span>, <span class="number">0xDA</span>, <span class="number">0xF9</span>, <span class="number">0x75</span>, <span class="number">0xF2</span>,</span><br><span class="line">  <span class="number">0x60</span>, <span class="number">0xBF</span>, <span class="number">0x33</span>, <span class="number">0xE3</span>, <span class="number">0x65</span>, <span class="number">0xA6</span>, <span class="number">0x62</span>, <span class="number">0x2A</span>, <span class="number">0x65</span>, <span class="number">0x24</span>,</span><br><span class="line">  <span class="number">0xB4</span>, <span class="number">0xBA</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    enc[i] ^= enc[(i + <span class="number">1</span>) % <span class="built_in">len</span>]</span><br><span class="line">    enc[i] ^= <span class="number">0x7A</span></span><br><span class="line">    enc[i] = (enc[i] &lt;&lt; <span class="number">4</span> | enc[i] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xff</span></span><br><span class="line">    enc[i] ^= <span class="number">0x64</span></span><br><span class="line">    enc[i] = (enc[i] &gt;&gt; <span class="number">5</span> | enc[i] &lt;&lt; <span class="number">3</span>) &amp; <span class="number">0xff</span></span><br><span class="line">    enc[i] ^= <span class="number">0x73</span></span><br><span class="line">    enc[i] = (enc[i] &gt;&gt; <span class="number">6</span> | enc[i] &lt;&lt; <span class="number">2</span>) &amp; <span class="number">0xff</span></span><br><span class="line">    enc[i] ^= <span class="number">0x71</span></span><br><span class="line">    enc[i] = (enc[i] &gt;&gt; <span class="number">7</span> | enc[i] &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    enc[i] = key.index(enc[i])</span><br><span class="line">    flag += <span class="built_in">chr</span>(enc[i] &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = hashlib.md5()</span><br><span class="line">a.update((flag).encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag&#123;&quot;</span>+a.hexdigest() + <span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{d5658c0b4c44d4672d76b563a8505a66}</p>

        <h2 id="babycode"   >
          <a href="#babycode" class="heading-link"><i class="fas fa-link"></i></a><a href="#babycode" class="headerlink" title="babycode"></a>babycode</h2>
      <p>.ll 文件是llvm下的字节码的文本形式</p>
<p>于是我们需要将其转换为可执行文件来进行分析</p>
<p>将字节码变为汇编后就能用clang编译</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llvm-as task.ll</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang task.bc -o struct</span><br></pre></td></tr></table></div></figure>

<p>然后拖进ida进行分析</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211041536330.png" alt="image-20221104153648189"></p>
<p>不难但是有几个点是要留意的</p>
<p>这里输入靠溢出分成了两节，先rc4加密前半节，然后将后16位和前16位异或后再用同一个s盒rc4加密，再整体base64</p>
<p>rc4是标准的，key = <code>llvmbitc</code></p>
<p>base64坑有点多</p>
<p><img src="https://raw.githubusercontent.com/745921536/MyImagepost/main/img/202211041541914.png" alt="image-20221104154113755"></p>
<p>一个是他3转4是时候顺序不太一样，但是结尾的3转4顺序是正常的</p>
<p>码表则是以<code>;</code>开头的64位</p>
<p>写脚本</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line">t = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc_init</span>():</span><br><span class="line">    key = [<span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x76</span>, <span class="number">0x6d</span>, <span class="number">0x62</span>, <span class="number">0x69</span>, <span class="number">0x74</span>, <span class="number">0x63</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        s[i] = i</span><br><span class="line">        t[i] = key[i % <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">    v3 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        v3 = (t[i] + s[i] + v3) % <span class="number">256</span></span><br><span class="line">        s[i], s[v3] = s[v3], s[i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc_decode</span>(<span class="params">enc</span>):</span><br><span class="line">    elen = <span class="built_in">len</span>(enc)</span><br><span class="line">    v4 = <span class="number">0</span></span><br><span class="line">    v5 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(elen):</span><br><span class="line">        v5 = (v5 + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        v4 = (s[v5] + v4) % <span class="number">256</span></span><br><span class="line">        s[v5], s[v4] = s[v4], s[v5]</span><br><span class="line">        enc[i] ^= s[(s[v4] + s[v5]) % <span class="number">256</span>] ^ <span class="number">0x59</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line">enc = <span class="string">&quot;TSz`kWKgbMHszXaj`@kLBmRrnTxsNtZsSOtZzqYikCw&quot;</span></span><br><span class="line">x = <span class="built_in">len</span>(enc)</span><br><span class="line">keyboard = <span class="string">&quot;;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">v4 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    x1 = keyboard.index(enc[i * <span class="number">4</span>])</span><br><span class="line">    x2 = keyboard.index(enc[i * <span class="number">4</span> + <span class="number">2</span>])</span><br><span class="line">    x3 = keyboard.index(enc[i * <span class="number">4</span> + <span class="number">1</span>])</span><br><span class="line">    x4 = keyboard.index(enc[i * <span class="number">4</span> + <span class="number">3</span>])</span><br><span class="line">    flag.append((x1 &lt;&lt; <span class="number">2</span>) &amp; <span class="number">0xff</span> | ((x2 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x3</span>))</span><br><span class="line">    flag.append(((x2 &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span>) | (x3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0xf</span>)</span><br><span class="line">    flag.append(((x3 &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">6</span>) | x4)</span><br><span class="line"></span><br><span class="line">x1 = keyboard.index(<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">x2 = keyboard.index(<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">x3 = keyboard.index(<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag.append((x1 &lt;&lt; <span class="number">2</span>) &amp; <span class="number">0xff</span> | (x2 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x3</span>)</span><br><span class="line">flag.append(((x2 &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span>) | (x3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0xf</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">f1 = flag[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">f2 = flag[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">rc_init()</span><br><span class="line">rc_decode(f1)</span><br><span class="line">rc_decode(f2)</span><br><span class="line"><span class="built_in">print</span>(f1)</span><br><span class="line"><span class="built_in">print</span>(f2)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    f2[i] ^= flag[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i &amp; <span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f2:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i &amp; <span class="number">0xff</span>), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>flag{Hacking_for_fun@reverser$!}</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/10/02/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">排序算法</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/09/18/C-STL-map/"><span class="paginator-prev__text">C++STL:map</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-2"><span class="toc-number">1.</span> <span class="toc-text">
          Week 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FindME"><span class="toc-number">1.1.</span> <span class="toc-text">
          FindME</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Likemayasp"><span class="toc-number">1.2.</span> <span class="toc-text">
          Likemayasp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Petals"><span class="toc-number">1.3.</span> <span class="toc-text">
          Petals</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week-3"><span class="toc-number">2.</span> <span class="toc-text">
          Week 3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Zzzzz3333"><span class="toc-number">2.1.</span> <span class="toc-text">
          Zzzzz3333</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EzTea"><span class="toc-number">2.2.</span> <span class="toc-text">
          EzTea</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Slider%E2%80%99s-Labyrinth"><span class="toc-number">2.3.</span> <span class="toc-text">
          The Slider’s Labyrinth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annnnnnggrr"><span class="toc-number">2.4.</span> <span class="toc-text">
          Annnnnnggrr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#funnyOTL-1"><span class="toc-number">2.5.</span> <span class="toc-text">
          funnyOTL_1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week4"><span class="toc-number">3.</span> <span class="toc-text">
          Week4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hash"><span class="toc-number">3.1.</span> <span class="toc-text">
          Hash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exception"><span class="toc-number">3.2.</span> <span class="toc-text">
          Exception</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HelpMe"><span class="toc-number">3.3.</span> <span class="toc-text">
          HelpMe</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week5"><span class="toc-number">4.</span> <span class="toc-text">
          Week5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%94%E4%B8%9D%E6%BA%9C%E8%82%86"><span class="toc-number">4.1.</span> <span class="toc-text">
          拔丝溜肆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#E4sy-Mix"><span class="toc-number">4.2.</span> <span class="toc-text">
          E4sy_Mix</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Petals-Level-Up"><span class="toc-number">4.3.</span> <span class="toc-text">
          Petals Level Up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babycode"><span class="toc-number">4.4.</span> <span class="toc-text">
          babycode</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/131.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">少壮不努力,老大亚托莉</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">38</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">分类</div></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>没有眼的鱼</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>