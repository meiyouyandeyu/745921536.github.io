<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="面向对象高级编程上课笔记（EffectiveJava）">
<meta property="og:type" content="article">
<meta property="og:title" content="面向对象高级编程上课笔记（EffectiveJava）">
<meta property="og:url" content="https://username.github.io/2023/06/08/EffectiveJava%E4%B8%8A%E8%AF%BE%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="鱼先生的格纳库">
<meta property="og:description" content="面向对象高级编程上课笔记（EffectiveJava）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-06-08T12:39:23.000Z">
<meta property="article:modified_time" content="2023-06-08T12:39:25.710Z">
<meta property="article:author" content="没有眼的鱼">
<meta name="twitter:card" content="summary"><title>面向对象高级编程上课笔记（EffectiveJava） | 鱼先生的格纳库</title><link ref="canonical" href="https://username.github.io/2023/06/08/EffectiveJava%E4%B8%8A%E8%AF%BE%E7%AC%94%E8%AE%B0/"><link rel="alternate" href="/atom.xml" type="application/atom+xml"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"ocean","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">鱼先生的格纳库</div><div class="header-banner-info__subtitle">没有眼的鱼</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">面向对象高级编程上课笔记（EffectiveJava）</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-06-08</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-06-08</span></span></div></header><div class="post-body">
        <h1 id="第二章-创建和销毁对象"   >
          <a href="#第二章-创建和销毁对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二章-创建和销毁对象" class="headerlink" title="第二章 创建和销毁对象"></a>第二章 创建和销毁对象</h1>
      
        <h2 id="1-用静态工厂方法代替构造器"   >
          <a href="#1-用静态工厂方法代替构造器" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-用静态工厂方法代替构造器" class="headerlink" title="1.用静态工厂方法代替构造器"></a>1.用静态工厂方法代替构造器</h2>
      <p>Service Provider 框架</p>
<p>样例代码</p>
<p>接口</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    AnimalFactory <span class="title function_">newService</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>静态工厂</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnimalFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Animal&gt; animals =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Animal&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_ANMIAL_NAME</span> <span class="operator">=</span> <span class="string">&quot;&lt;def&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">DefaultAnimal</span><span class="params">(Animal a)</span> &#123;</span><br><span class="line">        registerProvider(DEFAULT_ANMIAL_NAME, a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerProvider</span><span class="params">(String name, Animal p)</span>&#123;</span><br><span class="line">        animals.put(name,p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AnimalFactory <span class="title function_">newInstance</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="keyword">return</span> newInstance(DEFAULT_ANMIAL_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AnimalFactory <span class="title function_">newInstance</span><span class="params">(String name)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> animals.get(name);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                    <span class="string">&quot;No provider registered with name: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> a.newService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        AnimalFactory.registerProvider(<span class="string">&quot;Cat&quot;</span>, Cat);</span><br><span class="line">        AnimalFactory.registerProvider(<span class="string">&quot;Dog&quot;</span>, Dog);</span><br><span class="line"></span><br><span class="line">        <span class="type">AnimalFactory</span> <span class="variable">Cat</span> <span class="operator">=</span> AnimalFactory.newInstance(<span class="string">&quot;Cat&quot;</span>);</span><br><span class="line">        <span class="type">AnimalFactory</span> <span class="variable">Dog</span> <span class="operator">=</span> AnimalFactory.newInstance(<span class="string">&quot;Dog&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(Cat);</span><br><span class="line">        System.out.println(Dog);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 注册对应的类 利用接口实现匿名内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Animal</span> <span class="variable">Cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> AnimalFactory <span class="title function_">newService</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnimalFactory</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span> <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;This is Cat&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Animal</span> <span class="variable">Dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> AnimalFactory <span class="title function_">newService</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnimalFactory</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;This is Dog&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="2-遇到多个构造器参数用构造器"   >
          <a href="#2-遇到多个构造器参数用构造器" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-遇到多个构造器参数用构造器" class="headerlink" title="2.遇到多个构造器参数用构造器"></a>2.遇到多个构造器参数用构造器</h2>
      <p>JavaBeans模式</p>

        <h3 id="Builder模式"   >
          <a href="#Builder模式" class="heading-link"><i class="fas fa-link"></i></a><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h3>
      <p>适用于类层次结构</p>
<p>创建Builder对象引入额外开销</p>
<p>Person类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String mName;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> mAge;</span><br><span class="line">    <span class="keyword">public</span> String mLocation;</span><br><span class="line">    <span class="keyword">public</span> String mGender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String mJob;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Builder</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String mName;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> mAge;</span><br><span class="line">        <span class="keyword">private</span> String mLocation;</span><br><span class="line">        <span class="keyword">private</span> String mGender;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String mJob;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mName = mName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">abstract</span> Person <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">abstract</span> T <span class="title function_">self</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmAge</span><span class="params">(<span class="type">int</span> mAge)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mAge = mAge;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmLocation</span><span class="params">(String mLocation)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mLocation = mLocation;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmGender</span><span class="params">(String mGender)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mGender = mGender;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmJob</span><span class="params">(String mJob)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mJob = mJob;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Person(Builder&lt;?&gt; builder) &#123;</span><br><span class="line">        <span class="built_in">this</span>.mAge = builder.mAge;</span><br><span class="line">        <span class="built_in">this</span>.mName = builder.mName;</span><br><span class="line">        <span class="built_in">this</span>.mGender = builder.mGender;</span><br><span class="line">        <span class="built_in">this</span>.mLocation = builder.mLocation;</span><br><span class="line">        <span class="built_in">this</span>.mJob = builder.mJob;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Hight类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hight</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> mHight;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">extends</span> <span class="title class_">Person</span>.Builder&lt;Builder&gt;&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">double</span> mHight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(mName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Hight <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Hight</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Builder <span class="title function_">self</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">SetmHight</span><span class="params">(<span class="type">int</span> mHight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mHight = mHight;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hight</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(builder);</span><br><span class="line">        mHight = builder.mHight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;名字：&quot;</span> + mName + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;性别：&quot;</span> + mGender + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;年龄：&quot;</span> + mAge + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;身高：&quot;</span> + mHight + <span class="string">&quot;cm&quot;</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;职业：&quot;</span> + mJob + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;地址：&quot;</span> + mLocation + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>Weight类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Weight</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> mWeight;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">extends</span> <span class="title class_">Person</span>.Builder&lt;Builder&gt;&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">double</span> mWeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(mName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Weight <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Weight</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Builder <span class="title function_">self</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">SetmWeight</span><span class="params">(<span class="type">int</span> mWeight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mWeight = mWeight;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Weight</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(builder);</span><br><span class="line">        mWeight = builder.mWeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;名字：&quot;</span> + mName + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;性别：&quot;</span> + mGender + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;年龄：&quot;</span> + mAge + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;体重：&quot;</span> + mWeight + <span class="string">&quot;kg&quot;</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;职业：&quot;</span> + mJob + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;地址：&quot;</span> + mLocation + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Hight</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hight</span>.Builder(<span class="string">&quot;张三&quot;</span>).</span><br><span class="line">                SetmHight(<span class="number">175</span>).SetmAge(<span class="number">24</span>).SetmLocation(<span class="string">&quot;深圳&quot;</span>).</span><br><span class="line">                SetmJob(<span class="string">&quot;学生&quot;</span>).SetmGender(<span class="string">&quot;男&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="type">Weight</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Weight</span>.Builder(<span class="string">&quot;李四&quot;</span>).</span><br><span class="line">                SetmWeight(<span class="number">80</span>).SetmAge(<span class="number">24</span>).SetmLocation(<span class="string">&quot;广州&quot;</span>).</span><br><span class="line">                SetmJob(<span class="string">&quot;学生&quot;</span>).SetmGender(<span class="string">&quot;男&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        System.out.println(h);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="3-用私有构造器或枚举类型强化Singleton属性"   >
          <a href="#3-用私有构造器或枚举类型强化Singleton属性" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-用私有构造器或枚举类型强化Singleton属性" class="headerlink" title="3.用私有构造器或枚举类型强化Singleton属性"></a>3.用私有构造器或枚举类型强化Singleton属性</h2>
      <p>Singleton：只实例化一次</p>
<ul>
<li>无状态对象，如函数</li>
<li>系统组件</li>
</ul>
<p>实现Singleton</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emperor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Emperor</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emperor</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Emperor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新建一个皇帝类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Emperor</span> <span class="variable">emperor</span> <span class="operator">=</span> Emperor.INSTANCE;</span><br><span class="line">        <span class="type">Emperor</span> <span class="variable">emperor1</span> <span class="operator">=</span> Emperor.INSTANCE;</span><br><span class="line">        <span class="keyword">if</span>(emperor1.equals(emperor)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;具有单例属性&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;不具有单例属性&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>公有成员是静态工厂方法</p>
<ul>
<li>灵活性</li>
<li>泛型Singleton工厂</li>
<li>通过方法引用作为提供者</li>
</ul>
<p>包含单个元素的枚举类型</p>

        <h2 id="4-通过私有构造器强化不可实例化的能力"   >
          <a href="#4-通过私有构造器强化不可实例化的能力" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-通过私有构造器强化不可实例化的能力" class="headerlink" title="4.通过私有构造器强化不可实例化的能力"></a>4.通过私有构造器强化不可实例化的能力</h2>
      <p>工具类</p>
<ul>
<li>无需实例化</li>
<li>不可为抽象类，可被子类化，子类可被实例化</li>
</ul>

        <h2 id="5-优先考虑依赖注入来引用资源"   >
          <a href="#5-优先考虑依赖注入来引用资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-优先考虑依赖注入来引用资源" class="headerlink" title="5.优先考虑依赖注入来引用资源"></a>5.优先考虑依赖注入来引用资源</h2>
      <p>某些类会依赖底层资源</p>
<ul>
<li><p>静态工具类</p>
</li>
<li><p>单例实现</p>
</li>
<li><p>只可支持单一资源</p>
</li>
</ul>

        <h2 id="6-避免创建不必要的对象"   >
          <a href="#6-避免创建不必要的对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-避免创建不必要的对象" class="headerlink" title="6.避免创建不必要的对象"></a>6.避免创建不必要的对象</h2>
      <p>同时提供了静态工厂方法和构造器的不可变类</p>
<ul>
<li>静态工厂方法优先</li>
<li>避免无意识的装箱</li>
<li>重用已知不会被修改的可变对象</li>
</ul>

        <h2 id="7-消除过期对象引用"   >
          <a href="#7-消除过期对象引用" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-消除过期对象引用" class="headerlink" title="7.消除过期对象引用"></a>7.消除过期对象引用</h2>
      <p>Java：垃圾回收功能（过期引用）</p>

        <h1 id="第三章-对所有类都通用的方法"   >
          <a href="#第三章-对所有类都通用的方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三章-对所有类都通用的方法" class="headerlink" title="第三章 对所有类都通用的方法"></a>第三章 对所有类都通用的方法</h1>
      
        <h2 id="10-覆盖equals方法的通用约定"   >
          <a href="#10-覆盖equals方法的通用约定" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-覆盖equals方法的通用约定" class="headerlink" title="10.覆盖equals方法的通用约定"></a>10.覆盖equals方法的通用约定</h2>
      <p>equals：判断两个示例是否（逻辑）相等</p>
<p>object中的equals方法：判断是否为同一个实例</p>
<p><strong>无需覆盖</strong></p>
<ul>
<li>类的每个实例确实是唯一的，例如Thread</li>
<li>无需关心实例之间是否逻辑相等</li>
<li>超类已覆盖</li>
<li>类或包是私有的</li>
</ul>
<p><strong>需要覆盖</strong></p>
<ul>
<li>有逻辑相等的概念，如两个内容一样的String</li>
</ul>
<p>覆盖约定</p>
<ul>
<li>自反性：对于非空x，有x.equals(x)返回true</li>
<li>对称性</li>
<li>传递性</li>
<li>一致性：对于非空x，y,当内容不变时，x.euqals(y)不变</li>
<li>非空性：对于非空x，x.equals(null)，返回false</li>
</ul>
<p>高质量equals方法：</p>
<ul>
<li>&#x3D;&#x3D;判断是否为该对象的引用</li>
<li>instanceof判断类型是否正确</li>
<li>转换参数</li>
<li>对域和对象校验是否匹配</li>
<li>满足对称性，传递性，一致性</li>
</ul>

        <h2 id="11-覆盖equals时一定要覆盖hashcode"   >
          <a href="#11-覆盖equals时一定要覆盖hashcode" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-覆盖equals时一定要覆盖hashcode" class="headerlink" title="11.覆盖equals时一定要覆盖hashcode"></a>11.覆盖equals时一定要覆盖hashcode</h2>
      <p>得以使用HashMap，HashSet，HashTable</p>
<ul>
<li>忽略冗余域</li>
<li>排除equals中没使用的域</li>
</ul>
<p>对于不可变类缓存HashCode</p>

        <h2 id="12-始终要覆盖toString"   >
          <a href="#12-始终要覆盖toString" class="heading-link"><i class="fas fa-link"></i></a><a href="#12-始终要覆盖toString" class="headerlink" title="12.始终要覆盖toString"></a>12.始终要覆盖toString</h2>
      
        <h2 id="13-谨慎覆盖clone方法"   >
          <a href="#13-谨慎覆盖clone方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-谨慎覆盖clone方法" class="headerlink" title="13.谨慎覆盖clone方法"></a>13.谨慎覆盖clone方法</h2>
      <p>cloneable接口决定了Object中受保护的clone方法实现的行为</p>
<ul>
<li>一个类实现了cloneable接口，Object的clone方法返回该对象的逐域拷贝，否则抛出异常</li>
<li>改变了超类中受保护的方法的行为</li>
</ul>

        <h2 id="14-考虑实现Comparable接口"   >
          <a href="#14-考虑实现Comparable接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#14-考虑实现Comparable接口" class="headerlink" title="14.考虑实现Comparable接口"></a>14.考虑实现Comparable接口</h2>
      <p>满足equals约定：自反性，对称性，传递性</p>
<p>或者使用Comparator</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator &lt; PhoneNumber &gt; COMPARATOR =</span><br><span class="line">    comparingInt((PhoneNumber pn) - &gt; pn.areaCode)</span><br><span class="line">    .thenComparingInt(pn - &gt; pn.prefix)</span><br><span class="line">    .thenComparingInt(pn - &gt; pn.lineNum);</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(PhoneNumber pn)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> COMPARATOR.compare(<span class="built_in">this</span>, pn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>代码样例：</p>
<p>Person类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> String job;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String id, String name, <span class="type">int</span> age, String job)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.job = job;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) o;</span><br><span class="line">        <span class="type">return</span> <span class="variable">age</span> <span class="operator">=</span>= person.age &amp;&amp; id.equals(person.id) &amp;&amp; name.equals(person.name) &amp;&amp; job.equals(person.job);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> id.hashCode();</span><br><span class="line">        result = <span class="number">31</span> * result + name.hashCode();</span><br><span class="line">        result = <span class="number">31</span> * result + Integer.hashCode(age);</span><br><span class="line">        result = <span class="number">31</span> * result + job.hashCode();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&#x27;&quot;</span> + id + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, job=&#x27;&quot;</span> + job + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Phone类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Screen screen;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">        <span class="type">double</span> length;</span><br><span class="line">        <span class="type">double</span> weight;</span><br><span class="line"></span><br><span class="line">        Screen(<span class="type">double</span> length, <span class="type">double</span> weight) &#123;</span><br><span class="line">            <span class="built_in">this</span>.length = length;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Screen <span class="title function_">deepcopy</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Screen</span>(<span class="built_in">this</span>.length, <span class="built_in">this</span>.weight);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">result</span> <span class="operator">=</span> (Phone)<span class="built_in">super</span>.clone();</span><br><span class="line">        result.screen = <span class="built_in">this</span>.screen.deepcopy();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">comparaTo</span><span class="params">(Phone p)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Double.compare(<span class="built_in">this</span>.screen.length*<span class="built_in">this</span>.screen.weight, p.screen.length*p.screen.weight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Phone</span><span class="params">(Phone phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.screen.weight = phone.screen.weight;</span><br><span class="line">        <span class="built_in">this</span>.screen.length = phone.screen.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">24</span>, <span class="string">&quot;学生&quot;</span>);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">        System.out.format(<span class="string">&quot;0x%x\n&quot;</span>, person.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="第四章-类与接口"   >
          <a href="#第四章-类与接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四章-类与接口" class="headerlink" title="第四章 类与接口"></a>第四章 类与接口</h1>
      
        <h2 id="15-使类和成员的可访问性最小化"   >
          <a href="#15-使类和成员的可访问性最小化" class="heading-link"><i class="fas fa-link"></i></a><a href="#15-使类和成员的可访问性最小化" class="headerlink" title="15.使类和成员的可访问性最小化"></a>15.使类和成员的可访问性最小化</h2>
      <ul>
<li>信息隐藏&#x2F;封装<ul>
<li>各个模块隐藏其细节</li>
<li>通过API进行通信</li>
</ul>
</li>
<li>信息隐藏的好处<ul>
<li>解耦</li>
<li>各个模块可以独立开发测试优化</li>
<li>提高模块的可重用性</li>
</ul>
</li>
<li>尽可能使每个类或成员不被外界访问</li>
<li>顶层类和接口<ul>
<li>包级私有<ul>
<li>无修饰符</li>
<li>只可以被包内实用</li>
</ul>
</li>
<li>公有（public）<ul>
<li>Public修饰符</li>
<li>包导出的API的一部分</li>
<li>后续版本需要对其进行支持</li>
</ul>
</li>
<li>若某顶层类（或接口）A只在另一个类B的内部用到，应使A成为B的私有嵌套类</li>
<li>降低不必要公有类的可访问性更重要</li>
</ul>
</li>
<li>成员（域，方法，嵌套类，嵌套接口）<ul>
<li>私有的（private）<ul>
<li>声明该成员的类内部可访问</li>
</ul>
</li>
<li>包级私有的（package-private）<ul>
<li>包内部的任何类都可访问</li>
</ul>
</li>
<li>受保护的（protected）<ul>
<li>声明该成员的类的子类可访问</li>
<li>包内部的任何类都可访问</li>
</ul>
</li>
<li>公有的（public）<ul>
<li>任何地方都可访问</li>
</ul>
</li>
<li>尽量减少包级私有（相对于私有）</li>
<li>受保护的成员尽量少用（相对于私有）</li>
<li>实例域不能是公有的</li>
<li>静态final常量可以为公有，但不能为可变对象的引用</li>
</ul>
</li>
</ul>

        <h2 id="16-在公有类中使用访问方法而非公有域"   >
          <a href="#16-在公有类中使用访问方法而非公有域" class="heading-link"><i class="fas fa-link"></i></a><a href="#16-在公有类中使用访问方法而非公有域" class="headerlink" title="16.在公有类中使用访问方法而非公有域"></a>16.在公有类中使用访问方法而非公有域</h2>
      
        <h2 id="17-使可变性最小化"   >
          <a href="#17-使可变性最小化" class="heading-link"><i class="fas fa-link"></i></a><a href="#17-使可变性最小化" class="headerlink" title="17.使可变性最小化"></a>17.使可变性最小化</h2>
      
        <h2 id="18-复合优先于继承"   >
          <a href="#18-复合优先于继承" class="heading-link"><i class="fas fa-link"></i></a><a href="#18-复合优先于继承" class="headerlink" title="18.复合优先于继承"></a>18.复合优先于继承</h2>
      <ul>
<li>包的内部可以使用，在同一个程序员的控制下</li>
<li>专门为继承而设计</li>
</ul>
<p>复合</p>
<ul>
<li>为现有的类为新类的一个组件</li>
<li>包装类</li>
</ul>

        <h2 id="20-接口优于抽象类"   >
          <a href="#20-接口优于抽象类" class="heading-link"><i class="fas fa-link"></i></a><a href="#20-接口优于抽象类" class="headerlink" title="20.接口优于抽象类"></a>20.接口优于抽象类</h2>
      <ul>
<li><p>接口（interface）</p>
<ul>
<li>不能实例化</li>
<li>可实现方法</li>
<li>类可以实现多个接口</li>
</ul>
</li>
<li><p>抽象类（abstract class）</p>
<ul>
<li>不能实例化</li>
<li>可实现方法</li>
<li>类只能继承一个抽象类</li>
</ul>
</li>
</ul>
<p>接口可以方便的实现混合类型，并构造非层次结构的类型框架</p>
<p>结合接口和抽象类的优点：骨架实现</p>
<ul>
<li>接口负责定义类型，或提供一些缺省方法</li>
<li>骨架类实现其余方法</li>
</ul>
<p>定义接口</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Machine</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">int</span> price)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Movable</span>  &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">start</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">stop</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Vehicle</span> <span class="keyword">extends</span> <span class="title class_">Machine</span>, Movable&#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Bus实现骨架类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bus</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> isRun;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> price;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRun == <span class="number">0</span>) &#123;</span><br><span class="line">            isRun = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRun == <span class="number">1</span>) &#123;</span><br><span class="line">            isRun = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start() != <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;启动成功&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;已启动&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="21-为后代设计接口"   >
          <a href="#21-为后代设计接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#21-为后代设计接口" class="headerlink" title="21.为后代设计接口"></a>21.为后代设计接口</h2>
      
        <h2 id="22-接口只用于定义类型"   >
          <a href="#22-接口只用于定义类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#22-接口只用于定义类型" class="headerlink" title="22.接口只用于定义类型"></a>22.接口只用于定义类型</h2>
      <p>工具类</p>
<ul>
<li>不可实例化</li>
<li>静态公有常量</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhysicalConstants</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">PhysicalConstants</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">AVOGADROS_NUMBER</span> <span class="operator">=</span> <span class="number">6.02214199e23</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">BOLTZMANN_CONSTANT</span> <span class="operator">=</span> <span class="number">1.3806503e-23</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">ELECTRON_MASS</span> <span class="operator">=</span> <span class="number">9.10938188e-31</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Use of static import to avoid qualifying constants</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">atoms</span><span class="params">(<span class="type">double</span> mols)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AVOGADROS_NUMBER * mols;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="23-类层次优于标签类"   >
          <a href="#23-类层次优于标签类" class="heading-link"><i class="fas fa-link"></i></a><a href="#23-类层次优于标签类" class="headerlink" title="23.类层次优于标签类"></a>23.类层次优于标签类</h2>
      <p>类层次</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class hierarchy replacement for a tagged class</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> radius;</span><br><span class="line"> </span><br><span class="line">    Circle(<span class="type">double</span> radius) &#123; <span class="built_in">this</span>.radius = radius; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span> &#123; <span class="keyword">return</span> Math.PI * (radius * radius); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> length;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> width;</span><br><span class="line"> </span><br><span class="line">    Rectangle(<span class="type">double</span> length, <span class="type">double</span> width) &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.width  = width;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span> &#123; <span class="keyword">return</span> length * width; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    Square(<span class="type">double</span> side) &#123;</span><br><span class="line">        <span class="built_in">super</span>(side, side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="24-优先考虑静态成员类"   >
          <a href="#24-优先考虑静态成员类" class="heading-link"><i class="fas fa-link"></i></a><a href="#24-优先考虑静态成员类" class="headerlink" title="24.优先考虑静态成员类"></a>24.优先考虑静态成员类</h2>
      <p>嵌套类</p>
<ul>
<li>静态成员类</li>
<li>非静态成员类</li>
<li>匿名类</li>
<li>局部类</li>
</ul>
<p>匿名类</p>
<ul>
<li>在使用的同时被声明和实例化</li>
<li>可以出现在任何允许出现表达式的地方</li>
<li>没有静态成员</li>
<li>无法实现多个接口，或者同时扩展类并实现接口</li>
<li>保持简短，否则影响可读性</li>
<li>创建函数对象</li>
</ul>

        <h1 id="第二章-创建和销毁对象-1"   >
          <a href="#第二章-创建和销毁对象-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二章-创建和销毁对象-1" class="headerlink" title="第二章 创建和销毁对象"></a>第二章 创建和销毁对象</h1>
      
        <h2 id="用静态工厂方法代替构造器"   >
          <a href="#用静态工厂方法代替构造器" class="heading-link"><i class="fas fa-link"></i></a><a href="#用静态工厂方法代替构造器" class="headerlink" title="用静态工厂方法代替构造器"></a>用静态工厂方法代替构造器</h2>
      <p>Service Provider 框架</p>
<p>样例代码</p>
<p>接口</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    AnimalFactory <span class="title function_">newService</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>静态工厂</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnimalFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Animal&gt; animals =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Animal&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_ANMIAL_NAME</span> <span class="operator">=</span> <span class="string">&quot;&lt;def&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">DefaultAnimal</span><span class="params">(Animal a)</span> &#123;</span><br><span class="line">        registerProvider(DEFAULT_ANMIAL_NAME, a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerProvider</span><span class="params">(String name, Animal p)</span>&#123;</span><br><span class="line">        animals.put(name,p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AnimalFactory <span class="title function_">newInstance</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="keyword">return</span> newInstance(DEFAULT_ANMIAL_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AnimalFactory <span class="title function_">newInstance</span><span class="params">(String name)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> animals.get(name);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                    <span class="string">&quot;No provider registered with name: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> a.newService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        AnimalFactory.registerProvider(<span class="string">&quot;Cat&quot;</span>, Cat);</span><br><span class="line">        AnimalFactory.registerProvider(<span class="string">&quot;Dog&quot;</span>, Dog);</span><br><span class="line"></span><br><span class="line">        <span class="type">AnimalFactory</span> <span class="variable">Cat</span> <span class="operator">=</span> AnimalFactory.newInstance(<span class="string">&quot;Cat&quot;</span>);</span><br><span class="line">        <span class="type">AnimalFactory</span> <span class="variable">Dog</span> <span class="operator">=</span> AnimalFactory.newInstance(<span class="string">&quot;Dog&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(Cat);</span><br><span class="line">        System.out.println(Dog);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 注册对应的类 利用接口实现匿名内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Animal</span> <span class="variable">Cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> AnimalFactory <span class="title function_">newService</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnimalFactory</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span> <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;This is Cat&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Animal</span> <span class="variable">Dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> AnimalFactory <span class="title function_">newService</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnimalFactory</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;This is Dog&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="遇到多个构造器参数用构造器"   >
          <a href="#遇到多个构造器参数用构造器" class="heading-link"><i class="fas fa-link"></i></a><a href="#遇到多个构造器参数用构造器" class="headerlink" title="遇到多个构造器参数用构造器"></a>遇到多个构造器参数用构造器</h2>
      <p>JavaBeans模式</p>

        <h2 id="Builder模式-1"   >
          <a href="#Builder模式-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Builder模式-1" class="headerlink" title="Builder模式"></a>Builder模式</h2>
      <p>适用于类层次结构</p>
<p>创建Builder对象引入额外开销</p>
<p>Person类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String mName;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> mAge;</span><br><span class="line">    <span class="keyword">public</span> String mLocation;</span><br><span class="line">    <span class="keyword">public</span> String mGender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String mJob;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Builder</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String mName;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> mAge;</span><br><span class="line">        <span class="keyword">private</span> String mLocation;</span><br><span class="line">        <span class="keyword">private</span> String mGender;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String mJob;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mName = mName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">abstract</span> Person <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">abstract</span> T <span class="title function_">self</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmAge</span><span class="params">(<span class="type">int</span> mAge)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mAge = mAge;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmLocation</span><span class="params">(String mLocation)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mLocation = mLocation;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmGender</span><span class="params">(String mGender)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mGender = mGender;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">SetmJob</span><span class="params">(String mJob)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mJob = mJob;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Person(Builder&lt;?&gt; builder) &#123;</span><br><span class="line">        <span class="built_in">this</span>.mAge = builder.mAge;</span><br><span class="line">        <span class="built_in">this</span>.mName = builder.mName;</span><br><span class="line">        <span class="built_in">this</span>.mGender = builder.mGender;</span><br><span class="line">        <span class="built_in">this</span>.mLocation = builder.mLocation;</span><br><span class="line">        <span class="built_in">this</span>.mJob = builder.mJob;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Hight类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hight</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> mHight;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">extends</span> <span class="title class_">Person</span>.Builder&lt;Builder&gt;&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">double</span> mHight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(mName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Hight <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Hight</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Builder <span class="title function_">self</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">SetmHight</span><span class="params">(<span class="type">int</span> mHight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mHight = mHight;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Hight</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(builder);</span><br><span class="line">        mHight = builder.mHight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;名字：&quot;</span> + mName + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;性别：&quot;</span> + mGender + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;年龄：&quot;</span> + mAge + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;身高：&quot;</span> + mHight + <span class="string">&quot;cm&quot;</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;职业：&quot;</span> + mJob + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;地址：&quot;</span> + mLocation + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>Weight类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Weight</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> mWeight;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">extends</span> <span class="title class_">Person</span>.Builder&lt;Builder&gt;&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">double</span> mWeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="title function_">Builder</span><span class="params">(String mName)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(mName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Weight <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Weight</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Builder <span class="title function_">self</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">SetmWeight</span><span class="params">(<span class="type">int</span> mWeight)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mWeight = mWeight;</span><br><span class="line">            <span class="keyword">return</span> self();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Weight</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(builder);</span><br><span class="line">        mWeight = builder.mWeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;名字：&quot;</span> + mName + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;性别：&quot;</span> + mGender + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;年龄：&quot;</span> + mAge + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;体重：&quot;</span> + mWeight + <span class="string">&quot;kg&quot;</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                + <span class="string">&quot;职业：&quot;</span> + mJob + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;地址：&quot;</span> + mLocation + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Hight</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hight</span>.Builder(<span class="string">&quot;张三&quot;</span>).</span><br><span class="line">                SetmHight(<span class="number">175</span>).SetmAge(<span class="number">24</span>).SetmLocation(<span class="string">&quot;深圳&quot;</span>).</span><br><span class="line">                SetmJob(<span class="string">&quot;学生&quot;</span>).SetmGender(<span class="string">&quot;男&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="type">Weight</span> <span class="variable">w</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Weight</span>.Builder(<span class="string">&quot;李四&quot;</span>).</span><br><span class="line">                SetmWeight(<span class="number">80</span>).SetmAge(<span class="number">24</span>).SetmLocation(<span class="string">&quot;广州&quot;</span>).</span><br><span class="line">                SetmJob(<span class="string">&quot;学生&quot;</span>).SetmGender(<span class="string">&quot;男&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        System.out.println(h);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="用私有构造器或枚举类型强化Singleton属性"   >
          <a href="#用私有构造器或枚举类型强化Singleton属性" class="heading-link"><i class="fas fa-link"></i></a><a href="#用私有构造器或枚举类型强化Singleton属性" class="headerlink" title="用私有构造器或枚举类型强化Singleton属性"></a>用私有构造器或枚举类型强化Singleton属性</h2>
      <p>Singleton：只实例化一次</p>
<ul>
<li>无状态对象，如函数</li>
<li>系统组件</li>
</ul>
<p>实现Singleton</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emperor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Emperor</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emperor</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Emperor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新建一个皇帝类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Emperor</span> <span class="variable">emperor</span> <span class="operator">=</span> Emperor.INSTANCE;</span><br><span class="line">        <span class="type">Emperor</span> <span class="variable">emperor1</span> <span class="operator">=</span> Emperor.INSTANCE;</span><br><span class="line">        <span class="keyword">if</span>(emperor1.equals(emperor)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;具有单例属性&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;不具有单例属性&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>公有成员是静态工厂方法</p>
<ul>
<li>灵活性</li>
<li>泛型Singleton工厂</li>
<li>通过方法引用作为提供者</li>
</ul>
<p>包含单个元素的枚举类型</p>

        <h2 id="通过私有构造器强化不可实例化的能力"   >
          <a href="#通过私有构造器强化不可实例化的能力" class="heading-link"><i class="fas fa-link"></i></a><a href="#通过私有构造器强化不可实例化的能力" class="headerlink" title="通过私有构造器强化不可实例化的能力"></a>通过私有构造器强化不可实例化的能力</h2>
      <p>工具类</p>
<ul>
<li>无需实例化</li>
<li>不可为抽象类，可被子类化，子类可被实例化</li>
</ul>

        <h2 id="优先考虑依赖注入来引用资源"   >
          <a href="#优先考虑依赖注入来引用资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#优先考虑依赖注入来引用资源" class="headerlink" title="优先考虑依赖注入来引用资源"></a>优先考虑依赖注入来引用资源</h2>
      <p>某些类会依赖底层资源</p>
<ul>
<li><p>静态工具类</p>
</li>
<li><p>单例实现</p>
</li>
<li><p>只可支持单一资源</p>
</li>
</ul>

        <h2 id="避免创建不必要的对象"   >
          <a href="#避免创建不必要的对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#避免创建不必要的对象" class="headerlink" title="避免创建不必要的对象"></a>避免创建不必要的对象</h2>
      <p>同时提供了静态工厂方法和构造器的不可变类</p>
<ul>
<li>静态工厂方法优先</li>
<li>避免无意识的装箱</li>
<li>重用已知不会被修改的可变对象</li>
</ul>

        <h2 id="7-消除过期对象引用-1"   >
          <a href="#7-消除过期对象引用-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-消除过期对象引用-1" class="headerlink" title="7.消除过期对象引用"></a>7.消除过期对象引用</h2>
      <p>Java：垃圾回收功能（过期引用）</p>

        <h1 id="第三章-对所有类都通用的方法-1"   >
          <a href="#第三章-对所有类都通用的方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三章-对所有类都通用的方法-1" class="headerlink" title="第三章 对所有类都通用的方法"></a>第三章 对所有类都通用的方法</h1>
      
        <h2 id="10-覆盖equals方法的通用约定-1"   >
          <a href="#10-覆盖equals方法的通用约定-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-覆盖equals方法的通用约定-1" class="headerlink" title="10.覆盖equals方法的通用约定"></a>10.覆盖equals方法的通用约定</h2>
      <p>equals：判断两个示例是否（逻辑）相等</p>
<p>object中的equals方法：判断是否为同一个实例</p>
<p><strong>无需覆盖</strong></p>
<ul>
<li>类的每个实例确实是唯一的，例如Thread</li>
<li>无需关心实例之间是否逻辑相等</li>
<li>超类已覆盖</li>
<li>类或包是私有的</li>
</ul>
<p><strong>需要覆盖</strong></p>
<ul>
<li>有逻辑相等的概念，如两个内容一样的String</li>
</ul>
<p>覆盖约定</p>
<ul>
<li>自反性：对于非空x，有x.equals(x)返回true</li>
<li>对称性</li>
<li>传递性</li>
<li>一致性：对于非空x，y,当内容不变时，x.euqals(y)不变</li>
<li>非空性：对于非空x，x.equals(null)，返回false</li>
</ul>
<p>高质量equals方法：</p>
<ul>
<li>&#x3D;&#x3D;判断是否为该对象的引用</li>
<li>instanceof判断类型是否正确</li>
<li>转换参数</li>
<li>对域和对象校验是否匹配</li>
<li>满足对称性，传递性，一致性</li>
</ul>

        <h2 id="11-覆盖equals时一定要覆盖hashcode-1"   >
          <a href="#11-覆盖equals时一定要覆盖hashcode-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-覆盖equals时一定要覆盖hashcode-1" class="headerlink" title="11.覆盖equals时一定要覆盖hashcode"></a>11.覆盖equals时一定要覆盖hashcode</h2>
      <p>得以使用HashMap，HashSet，HashTable</p>
<ul>
<li>忽略冗余域</li>
<li>排除equals中没使用的域</li>
</ul>
<p>对于不可变类缓存HashCode</p>

        <h2 id="12-始终要覆盖toString-1"   >
          <a href="#12-始终要覆盖toString-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#12-始终要覆盖toString-1" class="headerlink" title="12.始终要覆盖toString"></a>12.始终要覆盖toString</h2>
      
        <h2 id="13-谨慎覆盖clone方法-1"   >
          <a href="#13-谨慎覆盖clone方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-谨慎覆盖clone方法-1" class="headerlink" title="13.谨慎覆盖clone方法"></a>13.谨慎覆盖clone方法</h2>
      <p>cloneable接口决定了Object中受保护的clone方法实现的行为</p>
<ul>
<li>一个类实现了cloneable接口，Object的clone方法返回该对象的逐域拷贝，否则抛出异常</li>
<li>改变了超类中受保护的方法的行为</li>
</ul>

        <h2 id="14-考虑实现Comparable接口-1"   >
          <a href="#14-考虑实现Comparable接口-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#14-考虑实现Comparable接口-1" class="headerlink" title="14.考虑实现Comparable接口"></a>14.考虑实现Comparable接口</h2>
      <p>满足equals约定：自反性，对称性，传递性</p>
<p>或者使用Comparator</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator &lt; PhoneNumber &gt; COMPARATOR =</span><br><span class="line">    comparingInt((PhoneNumber pn) - &gt; pn.areaCode)</span><br><span class="line">    .thenComparingInt(pn - &gt; pn.prefix)</span><br><span class="line">    .thenComparingInt(pn - &gt; pn.lineNum);</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(PhoneNumber pn)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> COMPARATOR.compare(<span class="built_in">this</span>, pn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>代码样例：</p>
<p>Person类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> String job;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String id, String name, <span class="type">int</span> age, String job)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.job = job;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) o;</span><br><span class="line">        <span class="type">return</span> <span class="variable">age</span> <span class="operator">=</span>= person.age &amp;&amp; id.equals(person.id) &amp;&amp; name.equals(person.name) &amp;&amp; job.equals(person.job);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> id.hashCode();</span><br><span class="line">        result = <span class="number">31</span> * result + name.hashCode();</span><br><span class="line">        result = <span class="number">31</span> * result + Integer.hashCode(age);</span><br><span class="line">        result = <span class="number">31</span> * result + job.hashCode();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&#x27;&quot;</span> + id + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, job=&#x27;&quot;</span> + job + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Phone类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Screen screen;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">        <span class="type">double</span> length;</span><br><span class="line">        <span class="type">double</span> weight;</span><br><span class="line"></span><br><span class="line">        Screen(<span class="type">double</span> length, <span class="type">double</span> weight) &#123;</span><br><span class="line">            <span class="built_in">this</span>.length = length;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Screen <span class="title function_">deepcopy</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Screen</span>(<span class="built_in">this</span>.length, <span class="built_in">this</span>.weight);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">result</span> <span class="operator">=</span> (Phone)<span class="built_in">super</span>.clone();</span><br><span class="line">        result.screen = <span class="built_in">this</span>.screen.deepcopy();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">comparaTo</span><span class="params">(Phone p)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Double.compare(<span class="built_in">this</span>.screen.length*<span class="built_in">this</span>.screen.weight, p.screen.length*p.screen.weight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Phone</span><span class="params">(Phone phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.screen.weight = phone.screen.weight;</span><br><span class="line">        <span class="built_in">this</span>.screen.length = phone.screen.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;123456&quot;</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">24</span>, <span class="string">&quot;学生&quot;</span>);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">        System.out.format(<span class="string">&quot;0x%x\n&quot;</span>, person.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="第四章-类与接口-1"   >
          <a href="#第四章-类与接口-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四章-类与接口-1" class="headerlink" title="第四章 类与接口"></a>第四章 类与接口</h1>
      
        <h2 id="15-使类和成员的可访问性最小化-1"   >
          <a href="#15-使类和成员的可访问性最小化-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#15-使类和成员的可访问性最小化-1" class="headerlink" title="15.使类和成员的可访问性最小化"></a>15.使类和成员的可访问性最小化</h2>
      <ul>
<li>信息隐藏&#x2F;封装<ul>
<li>各个模块隐藏其细节</li>
<li>通过API进行通信</li>
</ul>
</li>
<li>信息隐藏的好处<ul>
<li>解耦</li>
<li>各个模块可以独立开发测试优化</li>
<li>提高模块的可重用性</li>
</ul>
</li>
<li>尽可能使每个类或成员不被外界访问</li>
<li>顶层类和接口<ul>
<li>包级私有<ul>
<li>无修饰符</li>
<li>只可以被包内实用</li>
</ul>
</li>
<li>公有（public）<ul>
<li>Public修饰符</li>
<li>包导出的API的一部分</li>
<li>后续版本需要对其进行支持</li>
</ul>
</li>
<li>若某顶层类（或接口）A只在另一个类B的内部用到，应使A成为B的私有嵌套类</li>
<li>降低不必要公有类的可访问性更重要</li>
</ul>
</li>
<li>成员（域，方法，嵌套类，嵌套接口）<ul>
<li>私有的（private）<ul>
<li>声明该成员的类内部可访问</li>
</ul>
</li>
<li>包级私有的（package-private）<ul>
<li>包内部的任何类都可访问</li>
</ul>
</li>
<li>受保护的（protected）<ul>
<li>声明该成员的类的子类可访问</li>
<li>包内部的任何类都可访问</li>
</ul>
</li>
<li>公有的（public）<ul>
<li>任何地方都可访问</li>
</ul>
</li>
<li>尽量减少包级私有（相对于私有）</li>
<li>受保护的成员尽量少用（相对于私有）</li>
<li>实例域不能是公有的</li>
<li>静态final常量可以为公有，但不能为可变对象的引用</li>
</ul>
</li>
</ul>

        <h2 id="16-在公有类中使用访问方法而非公有域-1"   >
          <a href="#16-在公有类中使用访问方法而非公有域-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#16-在公有类中使用访问方法而非公有域-1" class="headerlink" title="16.在公有类中使用访问方法而非公有域"></a>16.在公有类中使用访问方法而非公有域</h2>
      
        <h2 id="17-使可变性最小化-1"   >
          <a href="#17-使可变性最小化-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#17-使可变性最小化-1" class="headerlink" title="17.使可变性最小化"></a>17.使可变性最小化</h2>
      
        <h2 id="18-复合优先于继承-1"   >
          <a href="#18-复合优先于继承-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#18-复合优先于继承-1" class="headerlink" title="18.复合优先于继承"></a>18.复合优先于继承</h2>
      <ul>
<li>包的内部可以使用，在同一个程序员的控制下</li>
<li>专门为继承而设计</li>
</ul>
<p>复合</p>
<ul>
<li>为现有的类为新类的一个组件</li>
<li>包装类</li>
</ul>

        <h2 id="20-接口优于抽象类-1"   >
          <a href="#20-接口优于抽象类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#20-接口优于抽象类-1" class="headerlink" title="20.接口优于抽象类"></a>20.接口优于抽象类</h2>
      <ul>
<li><p>接口（interface）</p>
<ul>
<li>不能实例化</li>
<li>可实现方法</li>
<li>类可以实现多个接口</li>
</ul>
</li>
<li><p>抽象类（abstract class）</p>
<ul>
<li>不能实例化</li>
<li>可实现方法</li>
<li>类只能继承一个抽象类</li>
</ul>
</li>
</ul>
<p>接口可以方便的实现混合类型，并构造非层次结构的类型框架</p>
<p>结合接口和抽象类的优点：骨架实现</p>
<ul>
<li>接口负责定义类型，或提供一些缺省方法</li>
<li>骨架类实现其余方法</li>
</ul>
<p>定义接口</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Machine</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">int</span> price)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Movable</span>  &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">start</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">stop</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Vehicle</span> <span class="keyword">extends</span> <span class="title class_">Machine</span>, Movable&#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Bus实现骨架类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bus</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> isRun;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> price;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRun == <span class="number">0</span>) &#123;</span><br><span class="line">            isRun = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRun == <span class="number">1</span>) &#123;</span><br><span class="line">            isRun = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start() != <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;启动成功&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;已启动&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="21-为后代设计接口-1"   >
          <a href="#21-为后代设计接口-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#21-为后代设计接口-1" class="headerlink" title="21.为后代设计接口"></a>21.为后代设计接口</h2>
      
        <h2 id="22-接口只用于定义类型-1"   >
          <a href="#22-接口只用于定义类型-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#22-接口只用于定义类型-1" class="headerlink" title="22.接口只用于定义类型"></a>22.接口只用于定义类型</h2>
      <p>工具类</p>
<ul>
<li>不可实例化</li>
<li>静态公有常量</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhysicalConstants</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">PhysicalConstants</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">AVOGADROS_NUMBER</span> <span class="operator">=</span> <span class="number">6.02214199e23</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">BOLTZMANN_CONSTANT</span> <span class="operator">=</span> <span class="number">1.3806503e-23</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">ELECTRON_MASS</span> <span class="operator">=</span> <span class="number">9.10938188e-31</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Use of static import to avoid qualifying constants</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">atoms</span><span class="params">(<span class="type">double</span> mols)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> AVOGADROS_NUMBER * mols;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="23-类层次优于标签类-1"   >
          <a href="#23-类层次优于标签类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#23-类层次优于标签类-1" class="headerlink" title="23.类层次优于标签类"></a>23.类层次优于标签类</h2>
      <p>类层次</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class hierarchy replacement for a tagged class</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> radius;</span><br><span class="line"> </span><br><span class="line">    Circle(<span class="type">double</span> radius) &#123; <span class="built_in">this</span>.radius = radius; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span> &#123; <span class="keyword">return</span> Math.PI * (radius * radius); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Figure</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> length;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">double</span> width;</span><br><span class="line"> </span><br><span class="line">    Rectangle(<span class="type">double</span> length, <span class="type">double</span> width) &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">        <span class="built_in">this</span>.width  = width;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span> &#123; <span class="keyword">return</span> length * width; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    Square(<span class="type">double</span> side) &#123;</span><br><span class="line">        <span class="built_in">super</span>(side, side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="24-优先考虑静态成员类-1"   >
          <a href="#24-优先考虑静态成员类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#24-优先考虑静态成员类-1" class="headerlink" title="24.优先考虑静态成员类"></a>24.优先考虑静态成员类</h2>
      <p>嵌套类</p>
<ul>
<li>静态成员类</li>
<li>非静态成员类</li>
<li>匿名类</li>
<li>局部类</li>
</ul>
<p>匿名类</p>
<ul>
<li>在使用的同时被声明和实例化</li>
<li>可以出现在任何允许出现表达式的地方</li>
<li>没有静态成员</li>
<li>无法实现多个接口，或者同时扩展类并实现接口</li>
<li>保持简短，否则影响可读性</li>
<li>创建函数对象</li>
</ul>
<p>局部类</p>
<ul>
<li><p>在可以声明局部变量的地方声明</p>
</li>
<li><p>有名字，可被重复使用</p>
</li>
<li><p>没有静态成员</p>
</li>
<li><p>保持简短，否则影响可读性</p>
</li>
</ul>

        <h2 id="25-限制源文件为单个顶级类"   >
          <a href="#25-限制源文件为单个顶级类" class="heading-link"><i class="fas fa-link"></i></a><a href="#25-限制源文件为单个顶级类" class="headerlink" title="25.限制源文件为单个顶级类"></a>25.限制源文件为单个顶级类</h2>
      
        <h1 id="第五章-泛型"   >
          <a href="#第五章-泛型" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五章-泛型" class="headerlink" title="第五章 泛型"></a>第五章 泛型</h1>
      <p>为什么引入泛型</p>
<ul>
<li>与C++ template类似，但目的有区别</li>
<li>减少程序运行错误的发生</li>
<li>减少方法的重载</li>
</ul>
<p>命名规则</p>
<ul>
<li>E - Element (通常代表集合类中的元素)</li>
<li>K - Key</li>
<li>N - Number</li>
<li>V - Value</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Util</span> &#123;  </span><br><span class="line"><span class="comment">//该方法用于比较两个Pair对象是否相等。  </span></span><br><span class="line"><span class="comment">//泛型参数必须写在方法返回类型boolean之前  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; <span class="type">boolean</span> <span class="title function_">compare</span><span class="params">(Pair&lt;K,V&gt; p1, Pair&lt;K, V&gt; p2)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> p1.getKey().equals(p2.getKey())&amp;&amp;  </span><br><span class="line">              p1.getValue().equals(p2.getValue());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line">Pair&lt;Integer,String&gt; p1 = <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(<span class="number">1</span>, <span class="string">&quot;apple&quot;</span>);  </span><br><span class="line">Pair&lt;Integer,String&gt; p2 = <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(<span class="number">2</span>, <span class="string">&quot;pear&quot;</span>);  </span><br><span class="line"><span class="type">boolean</span> <span class="variable">same</span> <span class="operator">=</span> Util.&lt;Integer, String&gt;compare(p1, p2);  </span><br><span class="line"><span class="comment">//实际上，编译器可以通过Pair当中的类型来推断compare需要使用的类型，所以可以简写为：  </span></span><br><span class="line"><span class="type">boolean</span> same2= Util. compare(p1, p2);  </span><br></pre></td></tr></table></div></figure>



<p>限制类型参数在某个范围内</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Box</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>&gt;&#123;  <span class="comment">//类型参数限定为Number的子类         </span></span><br><span class="line">      <span class="keyword">private</span> T t;         </span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Box</span><span class="params">(T t)</span>&#123;  </span><br><span class="line">             <span class="built_in">this</span>.t = t;  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;  </span><br><span class="line">             System.out.println(t.getClass().getName());  </span><br><span class="line">      &#125;         </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">   </span><br><span class="line">             Box&lt;Integer&gt; box1 = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;Integer&gt;(<span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">2</span>));  </span><br><span class="line">             box1.print();  <span class="comment">//打印结果：java.lang.Integer  </span></span><br><span class="line">             Box&lt;Double&gt; box2 = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;Double&gt;(<span class="keyword">new</span> <span class="title class_">Double</span>(<span class="number">1.2</span>));  </span><br><span class="line">             box2.print();  <span class="comment">//打印结果：java.lang.Double  </span></span><br><span class="line">              </span><br><span class="line">             Box&lt;String&gt; box2 = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;String&gt;(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>)); <span class="comment">//报错，因为String类型不是Number的子类  </span></span><br><span class="line">             box2.print();  </span><br><span class="line">      </span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Box</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Number</span> &amp; Cloneable &amp; Comparable &gt;&#123;   </span><br><span class="line"><span class="comment">//该类型必须为Number的子类并且实现了Cloneable接口和Comparable接口。  </span></span><br><span class="line">……  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></div></figure>



<p>泛型类的继承</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">someObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="type">Integer</span> <span class="variable">someInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>);</span><br><span class="line">someObject = someInteger; <span class="comment">// 因为Integer是Object的子类  </span></span><br><span class="line">Box &lt; Number &gt; box = <span class="keyword">new</span> <span class="title class_">Box</span> &lt; Number &gt; ();</span><br><span class="line">box.add(<span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>)); <span class="comment">// Integer是Number的子类  </span></span><br><span class="line">box.add(<span class="keyword">new</span> <span class="title class_">Double</span>(<span class="number">10.1</span>)); <span class="comment">// Double同样是Number的子类  </span></span><br><span class="line"><span class="comment">//该方法接受的参数类型为Box&lt;Number&gt;  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">boxTest</span><span class="params">(Box &lt; Number &gt; n)</span> &#123;</span><br><span class="line">    ……&#125;</span><br><span class="line"><span class="comment">//下面两种调用都会报错  </span></span><br><span class="line">boxTest(Box &lt; Integer &gt; );</span><br><span class="line">boxTest(Box &lt; Double &gt; );</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>通配符</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该方法接受的参数类型为Box&lt;Number&gt;  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">boxTest</span><span class="params">(Box &lt; Number &gt; n)</span> &#123;</span><br><span class="line">    ……&#125;</span><br><span class="line"><span class="comment">//下面两种调用都会报错  </span></span><br><span class="line">boxTest(Box &lt; Integer &gt; );</span><br><span class="line">boxTest(Box &lt; Double &gt; );</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">boxTest</span><span class="params">(Box &lt; ? extends Number &gt; n)</span> &#123;</span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="26-不要使用原生态类型"   >
          <a href="#26-不要使用原生态类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#26-不要使用原生态类型" class="headerlink" title="26.不要使用原生态类型"></a>26.不要使用原生态类型</h2>
      <p>原生态类型（raw type）</p>
<ul>
<li>不带任何实际类型参数的泛型名称</li>
<li>每个泛型都定一个原生态类型</li>
<li>List&lt;E&gt;的原生态类型是List</li>
</ul>

        <h2 id="27-消除非受检警告"   >
          <a href="#27-消除非受检警告" class="heading-link"><i class="fas fa-link"></i></a><a href="#27-消除非受检警告" class="headerlink" title="27.消除非受检警告"></a>27.消除非受检警告</h2>
      <ul>
<li>改写代码</li>
<li>@SuppressWarnings(“unchecked”)<ul>
<li>无法通过修改代码消除警告</li>
<li>证明代码是安全的</li>
<li>在尽可能小得范围内使用</li>
<li>添加对应注释</li>
</ul>
</li>
</ul>

        <h2 id="28-列表优先数组"   >
          <a href="#28-列表优先数组" class="heading-link"><i class="fas fa-link"></i></a><a href="#28-列表优先数组" class="headerlink" title="28.列表优先数组"></a>28.列表优先数组</h2>
      <ul>
<li>数组与泛型的不同<ul>
<li>数组是协变的，泛型是不可变的</li>
<li>数组是具体化的（reified），泛型是通过擦除（erasure）来实现的<ul>
<li>数组和泛型不能很好的混合使用</li>
<li>无法创建泛型（List&lt;E&gt;[]）、参数化类型（List&lt;String&gt;[]）或类型参数（E[]）的数组</li>
<li>优先利用集合类型list&lt;E&gt;，而不是数组类型E[]</li>
</ul>
</li>
</ul>
</li>
</ul>

        <h2 id="29-优先考虑泛型"   >
          <a href="#29-优先考虑泛型" class="heading-link"><i class="fas fa-link"></i></a><a href="#29-优先考虑泛型" class="headerlink" title="29.优先考虑泛型"></a>29.优先考虑泛型</h2>
      <p>不能创建不可具体化类型的数组</p>
<ul>
<li>方法1：创建Object数组，转换为泛型数组类型</li>
<li>方法2：将elements域的类型从E[]改为Object[]。获取元素时进行类型转换</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generic stack using Object[] </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stack</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Object[] elements;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Stack</span><span class="params">()</span> &#123;</span><br><span class="line">        elements = <span class="keyword">new</span> <span class="title class_">Object</span>[DEFAULT_INITIAL_CAPACITY];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        ensureCapacity();</span><br><span class="line">        elements[size++] = e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Appropriate suppression of unchecked warning</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmptyStackException</span>();</span><br><span class="line">       <span class="comment">// push requires elements to be of type E, so cast is correct</span></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="type">E</span> <span class="variable">result</span> <span class="operator">=</span></span><br><span class="line">                (E) elements[--size];</span><br><span class="line">        elements[size] = <span class="literal">null</span>; <span class="comment">// Eliminate obsolete reference</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="30-优先考虑泛型方法"   >
          <a href="#30-优先考虑泛型方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#30-优先考虑泛型方法" class="headerlink" title="30.优先考虑泛型方法"></a>30.优先考虑泛型方法</h2>
      <p>编写泛型方法与编写泛型类型类似</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generic method</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt; E &gt; Set &lt; E &gt; union(Set &lt; E &gt; s1, Set &lt; E &gt; s2) &#123;</span><br><span class="line">    Set &lt; E &gt; result = <span class="keyword">new</span> <span class="title class_">HashSet</span> &lt; &gt; (s1);</span><br><span class="line">    result.addAll(s2);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Simple program to exercise generic method</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    Set &lt; String &gt; guys = Set.of(<span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;Dick&quot;</span>, <span class="string">&quot;Harry&quot;</span>);</span><br><span class="line">    Set &lt; String &gt; stooges = Set.of(<span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;Moe&quot;</span>, <span class="string">&quot;Curly&quot;</span>);</span><br><span class="line">    Set &lt; String &gt; aflCio = union(guys, stooges);</span><br><span class="line">    System.out.println(aflCio);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>泛型单例工厂</p>
<p>递归类型限制</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecursiveTypeBound</span> &#123;</span><br><span class="line">    <span class="comment">// Returns max value in a collection - uses recursive type bound</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;E <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;E&gt;&gt; E <span class="title function_">max</span><span class="params">(Collection&lt;E&gt; c)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (c.isEmpty())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Empty collection&quot;</span>);</span><br><span class="line">         <span class="type">E</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (E e : c)</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span> || e.compareTo(result) &gt; <span class="number">0</span>)</span><br><span class="line">                result = Objects.requireNonNull(e);</span><br><span class="line">         <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; argList = Arrays.asList(args);</span><br><span class="line">        System.out.println(max(argList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="31-利用有限制的通配符来提升API的灵活性"   >
          <a href="#31-利用有限制的通配符来提升API的灵活性" class="heading-link"><i class="fas fa-link"></i></a><a href="#31-利用有限制的通配符来提升API的灵活性" class="headerlink" title="31.利用有限制的通配符来提升API的灵活性"></a>31.利用有限制的通配符来提升API的灵活性</h2>
      
        <h2 id="33-优先考虑类型安全的异构容器"   >
          <a href="#33-优先考虑类型安全的异构容器" class="heading-link"><i class="fas fa-link"></i></a><a href="#33-优先考虑类型安全的异构容器" class="headerlink" title="33.优先考虑类型安全的异构容器"></a>33.优先考虑类型安全的异构容器</h2>
      <p>容器需要更多的灵活性</p>
<ul>
<li>将键（key）参数化，而不是将容器（container）参数化</li>
</ul>

        <h1 id="第六章-枚举和注解"   >
          <a href="#第六章-枚举和注解" class="heading-link"><i class="fas fa-link"></i></a><a href="#第六章-枚举和注解" class="headerlink" title="第六章 枚举和注解"></a>第六章 枚举和注解</h1>
      
        <h2 id="34-用enum代替int常量"   >
          <a href="#34-用enum代替int常量" class="heading-link"><i class="fas fa-link"></i></a><a href="#34-用enum代替int常量" class="headerlink" title="34.用enum代替int常量"></a>34.用enum代替int常量</h2>
      <p>枚举类型</p>
<ul>
<li>提供编译时的类型安全</li>
<li>有命名空间，可以有同名常量</li>
<li>可以添加任意的方法和域</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    PLUS(<span class="string">&quot;+&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MINUS(<span class="string">&quot;-&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x - y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    TIMES(<span class="string">&quot;*&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x * y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DIVIDE(<span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x / y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String symbol;</span><br><span class="line"></span><br><span class="line">    Operation(String symbol) &#123;</span><br><span class="line">        <span class="built_in">this</span>.symbol = symbol;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> symbol;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Welcome</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Operation.PLUS.apply(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="35-用实例域代替序数"   >
          <a href="#35-用实例域代替序数" class="heading-link"><i class="fas fa-link"></i></a><a href="#35-用实例域代替序数" class="headerlink" title="35.用实例域代替序数"></a>35.用实例域代替序数</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Ensemble</span> &#123;</span><br><span class="line">    SOLO(<span class="number">1</span>), DUET(<span class="number">2</span>), TRIO(<span class="number">3</span>), QUARTET(<span class="number">4</span>), QUINTET(<span class="number">5</span>),</span><br><span class="line">    SEXTET(<span class="number">6</span>), SEPTET(<span class="number">7</span>), OCTET(<span class="number">8</span>), DOUBLE_QUARTET(<span class="number">8</span>),</span><br><span class="line">    NONET(<span class="number">9</span>), DECTET(<span class="number">10</span>), TRIPLE_QUARTET(<span class="number">12</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> numberOfMusicians;</span><br><span class="line">    Ensemble(<span class="type">int</span> size) &#123;</span><br><span class="line">        <span class="built_in">this</span>.numberOfMusicians = size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numberOfMusicians</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> numberOfMusicians;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="36-用EnumSet代替位域"   >
          <a href="#36-用EnumSet代替位域" class="heading-link"><i class="fas fa-link"></i></a><a href="#36-用EnumSet代替位域" class="headerlink" title="36.用EnumSet代替位域"></a>36.用EnumSet代替位域</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Text</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Style</span> &#123; BOLD, ITALIC, UNDERLINE, STRIKETHROUGH &#125;</span><br><span class="line">    <span class="comment">// Any Set could be passed in, but EnumSet is clearly best</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">applyStyles</span><span class="params">(Set &lt; Style &gt; styles)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text.applyStyles(EnumSet.of(Style.BOLD, Style.ITALIC));</span><br></pre></td></tr></table></div></figure>




        <h2 id="37-用EnumMap代替序数索引"   >
          <a href="#37-用EnumMap代替序数索引" class="heading-link"><i class="fas fa-link"></i></a><a href="#37-用EnumMap代替序数索引" class="headerlink" title="37.用EnumMap代替序数索引"></a>37.用EnumMap代替序数索引</h2>
      <p>枚举类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MixColor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">        Red(<span class="string">&quot;Red&quot;</span>), Blue(<span class="string">&quot;Blue&quot;</span>), Green(<span class="string">&quot;Green&quot;</span>),</span><br><span class="line">        Cyan(<span class="string">&quot;Cyan&quot;</span>), Purple(<span class="string">&quot;Purple&quot;</span>), White(<span class="string">&quot;White&quot;</span>),</span><br><span class="line">        Yellow(<span class="string">&quot;Yellow&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String symbol;</span><br><span class="line">        Color(String symbol) &#123;</span><br><span class="line">            <span class="built_in">this</span>.symbol = symbol;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> symbol;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;EnumSet&lt;Color&gt;, Color&gt; m = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">applyStyles</span><span class="params">()</span> &#123;</span><br><span class="line">        m.put(EnumSet.of(Color.Red), Color.Red);</span><br><span class="line">        m.put(EnumSet.of(Color.Blue), Color.Blue);</span><br><span class="line">        m.put(EnumSet.of(Color.Green), Color.Green);</span><br><span class="line">        m.put(EnumSet.of(Color.Red, Color.Green), Color.Yellow);</span><br><span class="line">        m.put(EnumSet.of(Color.Green, Color.Blue), Color.Cyan);</span><br><span class="line">        m.put(EnumSet.of(Color.Red, Color.Blue), Color.Purple);</span><br><span class="line">        m.put(EnumSet.of(Color.Red, Color.Blue, Color.Green), Color.White);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MixColor() &#123;</span><br><span class="line">        applyStyles();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>主函数</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MixColor</span> <span class="variable">mixColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MixColor</span>();</span><br><span class="line">        System.out.println(MixColor.m.get(EnumSet.of(MixColor.Color.Blue, MixColor.Color.Red)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="38-用接口模拟可伸缩的枚举类型"   >
          <a href="#38-用接口模拟可伸缩的枚举类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#38-用接口模拟可伸缩的枚举类型" class="headerlink" title="38.用接口模拟可伸缩的枚举类型"></a>38.用接口模拟可伸缩的枚举类型</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Emulated extensible enum using an interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BasicOperation</span> <span class="keyword">implements</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    PLUS(<span class="string">&quot;+&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123; <span class="keyword">return</span> x + y; &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MINUS(<span class="string">&quot;-&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123; <span class="keyword">return</span> x - y; &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    TIMES(<span class="string">&quot;*&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123; <span class="keyword">return</span> x * y; &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DIVIDE(<span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123; <span class="keyword">return</span> x / y; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String symbol;</span><br><span class="line">    BasicOperation(String symbol) &#123;</span><br><span class="line">        <span class="built_in">this</span>.symbol = symbol;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> symbol;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="39-注解优先于命名模式"   >
          <a href="#39-注解优先于命名模式" class="heading-link"><i class="fas fa-link"></i></a><a href="#39-注解优先于命名模式" class="headerlink" title="39.注解优先于命名模式"></a>39.注解优先于命名模式</h2>
      
        <h2 id="40-坚持使用Override注解"   >
          <a href="#40-坚持使用Override注解" class="heading-link"><i class="fas fa-link"></i></a><a href="#40-坚持使用Override注解" class="headerlink" title="40.坚持使用Override注解"></a>40.坚持使用Override注解</h2>
      
        <h1 id="第七章-Lamda和Stream"   >
          <a href="#第七章-Lamda和Stream" class="heading-link"><i class="fas fa-link"></i></a><a href="#第七章-Lamda和Stream" class="headerlink" title="第七章 Lamda和Stream"></a>第七章 Lamda和Stream</h1>
      
        <h2 id="42-Lambda优先于匿名类"   >
          <a href="#42-Lambda优先于匿名类" class="heading-link"><i class="fas fa-link"></i></a><a href="#42-Lambda优先于匿名类" class="headerlink" title="42.Lambda优先于匿名类"></a>42.Lambda优先于匿名类</h2>
      <p>Lambda表达式</p>
<ul>
<li>代码简短</li>
<li>无需名称和文档</li>
<li>不可创建或继承抽象类的实例</li>
<li>不适用于创建具有多个抽象方法的接口实例</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Anonymous class instance as a function object - obsolete!</span></span><br><span class="line">Collections.sort(words, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;String&gt;() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(s1.length(), s2.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lambda expression as function object (replaces anonymous class)</span></span><br><span class="line">Collections.sort(words,</span><br><span class="line">        (s1, s2) -&gt; Integer.compare(s1.length(), s2.length()));</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="43-方法引用优先于Lambda"   >
          <a href="#43-方法引用优先于Lambda" class="heading-link"><i class="fas fa-link"></i></a><a href="#43-方法引用优先于Lambda" class="headerlink" title="43.方法引用优先于Lambda"></a>43.方法引用优先于Lambda</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Frequency table implemented with map.merge, using lambda and method reference (Page 197)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Freq</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; frequencyTable = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String s : args)</span><br><span class="line">            frequencyTable.merge(s, <span class="number">1</span>, (count, incr) -&gt; count + incr); <span class="comment">// Lambda</span></span><br><span class="line">        System.out.println(frequencyTable);</span><br><span class="line">        frequencyTable.clear();</span><br><span class="line">        <span class="keyword">for</span> (String s : args)</span><br><span class="line">            frequencyTable.merge(s, <span class="number">1</span>, Integer::sum); <span class="comment">// Method reference</span></span><br><span class="line">        System.out.println(frequencyTable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span> V <span class="title function_">merge</span><span class="params">(K key, V value,</span></span><br><span class="line"><span class="params">  BiFunction&lt;? <span class="built_in">super</span> V, ? <span class="built_in">super</span> V, ? extends V&gt; remappingFunction)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(remappingFunction);</span><br><span class="line">    Objects.requireNonNull(value);</span><br><span class="line">    <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> get(key);</span><br><span class="line">    <span class="type">V</span> <span class="variable">newValue</span> <span class="operator">=</span> (oldValue == <span class="literal">null</span>) ? value :</span><br><span class="line">               remappingFunction.apply(oldValue, value);</span><br><span class="line">    <span class="keyword">if</span> (newValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        remove(key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        put(key, newValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="44-优先使用标准函数接口"   >
          <a href="#44-优先使用标准函数接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#44-优先使用标准函数接口" class="headerlink" title="44.优先使用标准函数接口"></a>44.优先使用标准函数接口</h2>
      <p>函数对象：实现了特定函数的对象</p>

        <h2 id="45-谨慎使用Stream"   >
          <a href="#45-谨慎使用Stream" class="heading-link"><i class="fas fa-link"></i></a><a href="#45-谨慎使用Stream" class="headerlink" title="45.谨慎使用Stream"></a>45.谨慎使用Stream</h2>
      <p>Stream是元素的集合，支持对元素进行顺序或者并行操作</p>
<p>foreach：</p>
<p>filter：</p>
<p>map：</p>
<p>sorted：</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// forEach</span></span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// filter</span></span><br><span class="line">List&lt;String&gt;strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> strings.stream().filter(string -&gt; string.isEmpty()).count();</span><br><span class="line"></span><br><span class="line"><span class="comment">// map</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">List&lt;Integer&gt; squaresList = numbers.stream().map( i -&gt; i*i).distinct().collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// sorted</span></span><br><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).sorted().forEach(System.out::println);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>避免使用Stream处理Char</p>

        <h2 id="46-优先选择Stream中无副作用的函数"   >
          <a href="#46-优先选择Stream中无副作用的函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#46-优先选择Stream中无副作用的函数" class="headerlink" title="46.优先选择Stream中无副作用的函数"></a>46.优先选择Stream中无副作用的函数</h2>
      
        <h1 id="第八章-方法"   >
          <a href="#第八章-方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#第八章-方法" class="headerlink" title="第八章 方法"></a>第八章 方法</h1>
      
        <h2 id="49-检查参数的有效性"   >
          <a href="#49-检查参数的有效性" class="heading-link"><i class="fas fa-link"></i></a><a href="#49-检查参数的有效性" class="headerlink" title="49.检查参数的有效性"></a>49.检查参数的有效性</h2>
      <p>对参数值进行限制</p>
<ul>
<li>索引非负</li>
<li>对象引用不为null</li>
</ul>

        <h2 id="50-必要时进行保护性拷贝"   >
          <a href="#50-必要时进行保护性拷贝" class="heading-link"><i class="fas fa-link"></i></a><a href="#50-必要时进行保护性拷贝" class="headerlink" title="50.必要时进行保护性拷贝"></a>50.必要时进行保护性拷贝</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">RaceTime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Date&gt; times;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RaceTime</span><span class="params">(Date... end)</span> &#123;</span><br><span class="line">        times = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Date date : end) &#123;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(date.getTime());</span><br><span class="line">            times.add(tmp);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        times.addAll(Arrays.asList(end));</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">retTime</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; times.size() || i &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    <span class="string">&quot;out of index&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 保护性拷贝</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(times.get(i).getTime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="51-谨慎设计方法签名"   >
          <a href="#51-谨慎设计方法签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#51-谨慎设计方法签名" class="headerlink" title="51.谨慎设计方法签名"></a>51.谨慎设计方法签名</h2>
      <p>谨慎选择方法的名称</p>
<p><strong>不要过于追求提供便利的方法</strong></p>
<p>避免过长的参数列表</p>

        <h2 id="52-明智地使用重载"   >
          <a href="#52-明智地使用重载" class="heading-link"><i class="fas fa-link"></i></a><a href="#52-明智地使用重载" class="headerlink" title="52.明智地使用重载"></a>52.明智地使用重载</h2>
      <p>在java中，具体调用的重载方法是编译时决定的</p>
<p>重载方法的选择是静态的，被覆盖的方法的选择是动态的</p>
<p>请勿写出具有相同参数数目的重载方法</p>

        <h2 id="53-明智地使用可变参数"   >
          <a href="#53-明智地使用可变参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#53-明智地使用可变参数" class="headerlink" title="53.明智地使用可变参数"></a>53.明智地使用可变参数</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The WRONG way to use varargs to pass one or more arguments!</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">min</span><span class="params">(<span class="type">int</span>... args)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Too few arguments&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; args.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (args[i] &lt; min)</span><br><span class="line">    min = args[i];</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The right way to use varargs to pass one or more arguments</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">min</span><span class="params">(<span class="type">int</span> firstArg, <span class="type">int</span>... remainingArgs)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> firstArg;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> arg : remainingArgs)</span><br><span class="line">        <span class="keyword">if</span> (arg &lt; min)</span><br><span class="line">    min = arg;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="54-返回零长度的数组或者集合而不是null"   >
          <a href="#54-返回零长度的数组或者集合而不是null" class="heading-link"><i class="fas fa-link"></i></a><a href="#54-返回零长度的数组或者集合而不是null" class="headerlink" title="54.返回零长度的数组或者集合而不是null"></a>54.返回零长度的数组或者集合而不是null</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Optimization - avoids allocating empty arrays</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Cheese[] EMPTY_CHEESE_ARRAY = <span class="keyword">new</span> <span class="title class_">Cheese</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">public</span> Cheese[] getCheeses() &#123;</span><br><span class="line">    <span class="keyword">return</span> cheesesInStock.toArray(EMPTY_CHEESE_ARRAY);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="55-明智地返回optional"   >
          <a href="#55-明智地返回optional" class="heading-link"><i class="fas fa-link"></i></a><a href="#55-明智地返回optional" class="headerlink" title="55.明智地返回optional"></a>55.明智地返回optional</h2>
      <p>方法在某些时候无法返回任何值</p>
<ul>
<li>抛出异常</li>
<li>返回null</li>
<li>返回Optional&lt;T&gt;</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns maximum value in collection - throws exception if empty</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;E&gt;&gt; E <span class="title function_">max</span><span class="params">(Collection&lt;E&gt; c)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (c.isEmpty())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Empty collection&quot;</span>);</span><br><span class="line">    <span class="type">E</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (E e : c)</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span> || e.compareTo(result) &gt; <span class="number">0</span>)</span><br><span class="line">    result = Objects.requireNonNull(e);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Returns maximum value in collection as an Optional&lt;E&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;E&gt;&gt; Optional&lt;E&gt; <span class="title function_">max</span><span class="params">(Collection&lt;E&gt; c)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (c.isEmpty())</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    <span class="type">E</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (E e : c)</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span> || e.compareTo(result) &gt; <span class="number">0</span>)</span><br><span class="line">    result = Objects.requireNonNull(e);</span><br><span class="line">    <span class="keyword">return</span> Optional.of(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Stream的终止操作返回Optional</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns max val in collection as Optional&lt;E&gt; - uses stream</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;E&gt;&gt; Optional&lt;E&gt; <span class="title function_">max</span><span class="params">(Collection&lt;E&gt; c)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.stream().max(Comparator.naturalOrder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="第九章-通用编程"   >
          <a href="#第九章-通用编程" class="heading-link"><i class="fas fa-link"></i></a><a href="#第九章-通用编程" class="headerlink" title="第九章 通用编程"></a>第九章 通用编程</h1>
      
        <h2 id="57-将局部变量的作用域最小化"   >
          <a href="#57-将局部变量的作用域最小化" class="heading-link"><i class="fas fa-link"></i></a><a href="#57-将局部变量的作用域最小化" class="headerlink" title="57.将局部变量的作用域最小化"></a>57.将局部变量的作用域最小化</h2>
      <p>与“使类和成员的可访问性最小化”本质上类似</p>
<p>在第一次使用局部变量的地方进行声明</p>
<p>局部变量的声明尽量包含一个初始化表达式</p>

        <h2 id="58-for-each循环优于传统循环"   >
          <a href="#58-for-each循环优于传统循环" class="heading-link"><i class="fas fa-link"></i></a><a href="#58-for-each循环优于传统循环" class="headerlink" title="58.for-each循环优于传统循环"></a>58.for-each循环优于传统循环</h2>
      <p>for-each循环可遍历任何实现Iterable接口的对象</p>
<p>无法使用for-each循环的情况</p>
<ul>
<li>解构过滤：遍历集合，删除特定元素</li>
<li>转换：遍历集合，替换特定元素</li>
<li>并行迭代：并行的遍历多个集合，同步前进</li>
</ul>

        <h2 id="59-了解和使用类库"   >
          <a href="#59-了解和使用类库" class="heading-link"><i class="fas fa-link"></i></a><a href="#59-了解和使用类库" class="headerlink" title="59.了解和使用类库"></a>59.了解和使用类库</h2>
      <p>使用标准类库的好处</p>
<ul>
<li>其实现经过检验，且会不断更新</li>
<li>无需花费时间在底层细节上</li>
<li>性能往往会逐渐提高</li>
<li>方便其他人阅读，重用</li>
</ul>
<p>总之，不要重新发明轮子</p>

        <h2 id="60-如果需要精确的答案，避免使用float和double"   >
          <a href="#60-如果需要精确的答案，避免使用float和double" class="heading-link"><i class="fas fa-link"></i></a><a href="#60-如果需要精确的答案，避免使用float和double" class="headerlink" title="60.如果需要精确的答案，避免使用float和double"></a>60.如果需要精确的答案，避免使用float和double</h2>
      <p>float和double并没有提供完全精确的结果，使用BigDecimal</p>

        <h2 id="61-基本类型优先于装箱基本类型"   >
          <a href="#61-基本类型优先于装箱基本类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#61-基本类型优先于装箱基本类型" class="headerlink" title="61.基本类型优先于装箱基本类型"></a>61.基本类型优先于装箱基本类型</h2>
      <ul>
<li>基本类型：int，double，Boolean</li>
<li>引用类型：String，List</li>
<li>装箱基本类型：Integer，Double，Boolean</li>
<li>自动装箱，自动拆箱</li>
</ul>
<p>基本类型和装箱类型的区别</p>
<ul>
<li>基本类型只有值比较，装箱基本类型具有同一性比较（identity comparison）</li>
<li>基本类型只有功能值，装箱基本类型有null</li>
<li>基本类型比装箱基本类型节省时间和空间</li>
</ul>
<p>何时应采用装箱基本类型</p>
<ul>
<li>作为集合中的元素、键和值</li>
<li>参数化类型中，必须使用装箱基本类型作为类型参数</li>
<li>进行反射的方法调用，必须使用装箱基本类型</li>
</ul>

        <h2 id="62-若其他类型更适合，尽量避免使用字符串"   >
          <a href="#62-若其他类型更适合，尽量避免使用字符串" class="heading-link"><i class="fas fa-link"></i></a><a href="#62-若其他类型更适合，尽量避免使用字符串" class="headerlink" title="62.若其他类型更适合，尽量避免使用字符串"></a>62.若其他类型更适合，尽量避免使用字符串</h2>
      
        <h2 id="63-注意字符串连接的性能"   >
          <a href="#63-注意字符串连接的性能" class="heading-link"><i class="fas fa-link"></i></a><a href="#63-注意字符串连接的性能" class="headerlink" title="63.注意字符串连接的性能"></a>63.注意字符串连接的性能</h2>
      
        <h2 id="64-通过接口引用对象"   >
          <a href="#64-通过接口引用对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#64-通过接口引用对象" class="headerlink" title="64.通过接口引用对象"></a>64.通过接口引用对象</h2>
      
        <h2 id="65-接口优先于反射机制"   >
          <a href="#65-接口优先于反射机制" class="heading-link"><i class="fas fa-link"></i></a><a href="#65-接口优先于反射机制" class="headerlink" title="65.接口优先于反射机制"></a>65.接口优先于反射机制</h2>
      <p>核心反射机制：通过程序来访问关于已装载的类的信息</p>
<p>执行反射访问所需要的代码非常笨拙和冗长</p>
<p>应用：frida</p>

        <h2 id="66-谨慎地使用本地方法"   >
          <a href="#66-谨慎地使用本地方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#66-谨慎地使用本地方法" class="headerlink" title="66.谨慎地使用本地方法"></a>66.谨慎地使用本地方法</h2>
      <p>本地方法：用本地程序设计语言（如C或C++）编写的方法</p>
<p>本地方法可方便完成一些特殊的任务，并可能提高性能</p>
<p>当Java本身的性能得到提升时，程序无法得到改善</p>

        <h2 id="67-谨慎地进行优化"   >
          <a href="#67-谨慎地进行优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#67-谨慎地进行优化" class="headerlink" title="67.谨慎地进行优化"></a>67.谨慎地进行优化</h2>
      
        <h2 id="68-遵守普遍接受的命名惯例"   >
          <a href="#68-遵守普遍接受的命名惯例" class="heading-link"><i class="fas fa-link"></i></a><a href="#68-遵守普遍接受的命名惯例" class="headerlink" title="68.遵守普遍接受的命名惯例"></a>68.遵守普遍接受的命名惯例</h2>
      </div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2023/06/09/%E7%AC%AC%E4%B8%89%E5%B1%8A%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9BRewp/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">第三届陕西省赛Rewp</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2023/06/02/UnCrackable-Level2/"><span class="paginator-prev__text">UnCrackable-Level2</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">
          第二章 创建和销毁对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%94%A8%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E4%BB%A3%E6%9B%BF%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">
          1.用静态工厂方法代替构造器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%81%87%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%9E%84%E9%80%A0%E5%99%A8%E5%8F%82%E6%95%B0%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">
          2.遇到多个构造器参数用构造器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Builder%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">
          Builder模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%94%A8%E7%A7%81%E6%9C%89%E6%9E%84%E9%80%A0%E5%99%A8%E6%88%96%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%BC%BA%E5%8C%96Singleton%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">
          3.用私有构造器或枚举类型强化Singleton属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%80%9A%E8%BF%87%E7%A7%81%E6%9C%89%E6%9E%84%E9%80%A0%E5%99%A8%E5%BC%BA%E5%8C%96%E4%B8%8D%E5%8F%AF%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E8%83%BD%E5%8A%9B"><span class="toc-number">1.4.</span> <span class="toc-text">
          4.通过私有构造器强化不可实例化的能力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%9D%A5%E5%BC%95%E7%94%A8%E8%B5%84%E6%BA%90"><span class="toc-number">1.5.</span> <span class="toc-text">
          5.优先考虑依赖注入来引用资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E9%81%BF%E5%85%8D%E5%88%9B%E5%BB%BA%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.6.</span> <span class="toc-text">
          6.避免创建不必要的对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%B6%88%E9%99%A4%E8%BF%87%E6%9C%9F%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8"><span class="toc-number">1.7.</span> <span class="toc-text">
          7.消除过期对象引用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%AF%B9%E6%89%80%E6%9C%89%E7%B1%BB%E9%83%BD%E9%80%9A%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">
          第三章 对所有类都通用的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%A6%86%E7%9B%96equals%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E7%BA%A6%E5%AE%9A"><span class="toc-number">2.1.</span> <span class="toc-text">
          10.覆盖equals方法的通用约定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E8%A6%86%E7%9B%96equals%E6%97%B6%E4%B8%80%E5%AE%9A%E8%A6%81%E8%A6%86%E7%9B%96hashcode"><span class="toc-number">2.2.</span> <span class="toc-text">
          11.覆盖equals时一定要覆盖hashcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%A7%8B%E7%BB%88%E8%A6%81%E8%A6%86%E7%9B%96toString"><span class="toc-number">2.3.</span> <span class="toc-text">
          12.始终要覆盖toString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E8%B0%A8%E6%85%8E%E8%A6%86%E7%9B%96clone%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">
          13.谨慎覆盖clone方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E8%80%83%E8%99%91%E5%AE%9E%E7%8E%B0Comparable%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.5.</span> <span class="toc-text">
          14.考虑实现Comparable接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">
          第四章 类与接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E4%BD%BF%E7%B1%BB%E5%92%8C%E6%88%90%E5%91%98%E7%9A%84%E5%8F%AF%E8%AE%BF%E9%97%AE%E6%80%A7%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">
          15.使类和成员的可访问性最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E5%9C%A8%E5%85%AC%E6%9C%89%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95%E8%80%8C%E9%9D%9E%E5%85%AC%E6%9C%89%E5%9F%9F"><span class="toc-number">3.2.</span> <span class="toc-text">
          16.在公有类中使用访问方法而非公有域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E4%BD%BF%E5%8F%AF%E5%8F%98%E6%80%A7%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">3.3.</span> <span class="toc-text">
          17.使可变性最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E5%A4%8D%E5%90%88%E4%BC%98%E5%85%88%E4%BA%8E%E7%BB%A7%E6%89%BF"><span class="toc-number">3.4.</span> <span class="toc-text">
          18.复合优先于继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E6%8E%A5%E5%8F%A3%E4%BC%98%E4%BA%8E%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">3.5.</span> <span class="toc-text">
          20.接口优于抽象类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E4%B8%BA%E5%90%8E%E4%BB%A3%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.6.</span> <span class="toc-text">
          21.为后代设计接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E6%8E%A5%E5%8F%A3%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.7.</span> <span class="toc-text">
          22.接口只用于定义类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E7%B1%BB%E5%B1%82%E6%AC%A1%E4%BC%98%E4%BA%8E%E6%A0%87%E7%AD%BE%E7%B1%BB"><span class="toc-number">3.8.</span> <span class="toc-text">
          23.类层次优于标签类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E7%B1%BB"><span class="toc-number">3.9.</span> <span class="toc-text">
          24.优先考虑静态成员类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%94%80%E6%AF%81%E5%AF%B9%E8%B1%A1-1"><span class="toc-number">4.</span> <span class="toc-text">
          第二章 创建和销毁对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E4%BB%A3%E6%9B%BF%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">
          用静态工厂方法代替构造器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%9E%84%E9%80%A0%E5%99%A8%E5%8F%82%E6%95%B0%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">
          遇到多个构造器参数用构造器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Builder%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.3.</span> <span class="toc-text">
          Builder模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E7%A7%81%E6%9C%89%E6%9E%84%E9%80%A0%E5%99%A8%E6%88%96%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E5%BC%BA%E5%8C%96Singleton%E5%B1%9E%E6%80%A7"><span class="toc-number">4.4.</span> <span class="toc-text">
          用私有构造器或枚举类型强化Singleton属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%A7%81%E6%9C%89%E6%9E%84%E9%80%A0%E5%99%A8%E5%BC%BA%E5%8C%96%E4%B8%8D%E5%8F%AF%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E8%83%BD%E5%8A%9B"><span class="toc-number">4.5.</span> <span class="toc-text">
          通过私有构造器强化不可实例化的能力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%9D%A5%E5%BC%95%E7%94%A8%E8%B5%84%E6%BA%90"><span class="toc-number">4.6.</span> <span class="toc-text">
          优先考虑依赖注入来引用资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%88%9B%E5%BB%BA%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.7.</span> <span class="toc-text">
          避免创建不必要的对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%B6%88%E9%99%A4%E8%BF%87%E6%9C%9F%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8-1"><span class="toc-number">4.8.</span> <span class="toc-text">
          7.消除过期对象引用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%AF%B9%E6%89%80%E6%9C%89%E7%B1%BB%E9%83%BD%E9%80%9A%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95-1"><span class="toc-number">5.</span> <span class="toc-text">
          第三章 对所有类都通用的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%A6%86%E7%9B%96equals%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E7%BA%A6%E5%AE%9A-1"><span class="toc-number">5.1.</span> <span class="toc-text">
          10.覆盖equals方法的通用约定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E8%A6%86%E7%9B%96equals%E6%97%B6%E4%B8%80%E5%AE%9A%E8%A6%81%E8%A6%86%E7%9B%96hashcode-1"><span class="toc-number">5.2.</span> <span class="toc-text">
          11.覆盖equals时一定要覆盖hashcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%A7%8B%E7%BB%88%E8%A6%81%E8%A6%86%E7%9B%96toString-1"><span class="toc-number">5.3.</span> <span class="toc-text">
          12.始终要覆盖toString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E8%B0%A8%E6%85%8E%E8%A6%86%E7%9B%96clone%E6%96%B9%E6%B3%95-1"><span class="toc-number">5.4.</span> <span class="toc-text">
          13.谨慎覆盖clone方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E8%80%83%E8%99%91%E5%AE%9E%E7%8E%B0Comparable%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">5.5.</span> <span class="toc-text">
          14.考虑实现Comparable接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">6.</span> <span class="toc-text">
          第四章 类与接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E4%BD%BF%E7%B1%BB%E5%92%8C%E6%88%90%E5%91%98%E7%9A%84%E5%8F%AF%E8%AE%BF%E9%97%AE%E6%80%A7%E6%9C%80%E5%B0%8F%E5%8C%96-1"><span class="toc-number">6.1.</span> <span class="toc-text">
          15.使类和成员的可访问性最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E5%9C%A8%E5%85%AC%E6%9C%89%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95%E8%80%8C%E9%9D%9E%E5%85%AC%E6%9C%89%E5%9F%9F-1"><span class="toc-number">6.2.</span> <span class="toc-text">
          16.在公有类中使用访问方法而非公有域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E4%BD%BF%E5%8F%AF%E5%8F%98%E6%80%A7%E6%9C%80%E5%B0%8F%E5%8C%96-1"><span class="toc-number">6.3.</span> <span class="toc-text">
          17.使可变性最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E5%A4%8D%E5%90%88%E4%BC%98%E5%85%88%E4%BA%8E%E7%BB%A7%E6%89%BF-1"><span class="toc-number">6.4.</span> <span class="toc-text">
          18.复合优先于继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E6%8E%A5%E5%8F%A3%E4%BC%98%E4%BA%8E%E6%8A%BD%E8%B1%A1%E7%B1%BB-1"><span class="toc-number">6.5.</span> <span class="toc-text">
          20.接口优于抽象类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E4%B8%BA%E5%90%8E%E4%BB%A3%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">6.6.</span> <span class="toc-text">
          21.为后代设计接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E6%8E%A5%E5%8F%A3%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">6.7.</span> <span class="toc-text">
          22.接口只用于定义类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E7%B1%BB%E5%B1%82%E6%AC%A1%E4%BC%98%E4%BA%8E%E6%A0%87%E7%AD%BE%E7%B1%BB-1"><span class="toc-number">6.8.</span> <span class="toc-text">
          23.类层次优于标签类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E7%B1%BB-1"><span class="toc-number">6.9.</span> <span class="toc-text">
          24.优先考虑静态成员类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E9%99%90%E5%88%B6%E6%BA%90%E6%96%87%E4%BB%B6%E4%B8%BA%E5%8D%95%E4%B8%AA%E9%A1%B6%E7%BA%A7%E7%B1%BB"><span class="toc-number">6.10.</span> <span class="toc-text">
          25.限制源文件为单个顶级类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E6%B3%9B%E5%9E%8B"><span class="toc-number">7.</span> <span class="toc-text">
          第五章 泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E6%80%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.1.</span> <span class="toc-text">
          26.不要使用原生态类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E6%B6%88%E9%99%A4%E9%9D%9E%E5%8F%97%E6%A3%80%E8%AD%A6%E5%91%8A"><span class="toc-number">7.2.</span> <span class="toc-text">
          27.消除非受检警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E5%88%97%E8%A1%A8%E4%BC%98%E5%85%88%E6%95%B0%E7%BB%84"><span class="toc-number">7.3.</span> <span class="toc-text">
          28.列表优先数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E6%B3%9B%E5%9E%8B"><span class="toc-number">7.4.</span> <span class="toc-text">
          29.优先考虑泛型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95"><span class="toc-number">7.5.</span> <span class="toc-text">
          30.优先考虑泛型方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E5%88%A9%E7%94%A8%E6%9C%89%E9%99%90%E5%88%B6%E7%9A%84%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9D%A5%E6%8F%90%E5%8D%87API%E7%9A%84%E7%81%B5%E6%B4%BB%E6%80%A7"><span class="toc-number">7.6.</span> <span class="toc-text">
          31.利用有限制的通配符来提升API的灵活性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E4%BC%98%E5%85%88%E8%80%83%E8%99%91%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%BC%82%E6%9E%84%E5%AE%B9%E5%99%A8"><span class="toc-number">7.7.</span> <span class="toc-text">
          33.优先考虑类型安全的异构容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">8.</span> <span class="toc-text">
          第六章 枚举和注解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E7%94%A8enum%E4%BB%A3%E6%9B%BFint%E5%B8%B8%E9%87%8F"><span class="toc-number">8.1.</span> <span class="toc-text">
          34.用enum代替int常量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-%E7%94%A8%E5%AE%9E%E4%BE%8B%E5%9F%9F%E4%BB%A3%E6%9B%BF%E5%BA%8F%E6%95%B0"><span class="toc-number">8.2.</span> <span class="toc-text">
          35.用实例域代替序数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-%E7%94%A8EnumSet%E4%BB%A3%E6%9B%BF%E4%BD%8D%E5%9F%9F"><span class="toc-number">8.3.</span> <span class="toc-text">
          36.用EnumSet代替位域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-%E7%94%A8EnumMap%E4%BB%A3%E6%9B%BF%E5%BA%8F%E6%95%B0%E7%B4%A2%E5%BC%95"><span class="toc-number">8.4.</span> <span class="toc-text">
          37.用EnumMap代替序数索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-%E7%94%A8%E6%8E%A5%E5%8F%A3%E6%A8%A1%E6%8B%9F%E5%8F%AF%E4%BC%B8%E7%BC%A9%E7%9A%84%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.5.</span> <span class="toc-text">
          38.用接口模拟可伸缩的枚举类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-%E6%B3%A8%E8%A7%A3%E4%BC%98%E5%85%88%E4%BA%8E%E5%91%BD%E5%90%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.6.</span> <span class="toc-text">
          39.注解优先于命名模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-%E5%9D%9A%E6%8C%81%E4%BD%BF%E7%94%A8Override%E6%B3%A8%E8%A7%A3"><span class="toc-number">8.7.</span> <span class="toc-text">
          40.坚持使用Override注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-Lamda%E5%92%8CStream"><span class="toc-number">9.</span> <span class="toc-text">
          第七章 Lamda和Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#42-Lambda%E4%BC%98%E5%85%88%E4%BA%8E%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="toc-number">9.1.</span> <span class="toc-text">
          42.Lambda优先于匿名类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E4%BC%98%E5%85%88%E4%BA%8ELambda"><span class="toc-number">9.2.</span> <span class="toc-text">
          43.方法引用优先于Lambda</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E6%A0%87%E5%87%86%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3"><span class="toc-number">9.3.</span> <span class="toc-text">
          44.优先使用标准函数接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E8%B0%A8%E6%85%8E%E4%BD%BF%E7%94%A8Stream"><span class="toc-number">9.4.</span> <span class="toc-text">
          45.谨慎使用Stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-%E4%BC%98%E5%85%88%E9%80%89%E6%8B%A9Stream%E4%B8%AD%E6%97%A0%E5%89%AF%E4%BD%9C%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">9.5.</span> <span class="toc-text">
          46.优先选择Stream中无副作用的函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E6%96%B9%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">
          第八章 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#49-%E6%A3%80%E6%9F%A5%E5%8F%82%E6%95%B0%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7"><span class="toc-number">10.1.</span> <span class="toc-text">
          49.检查参数的有效性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50-%E5%BF%85%E8%A6%81%E6%97%B6%E8%BF%9B%E8%A1%8C%E4%BF%9D%E6%8A%A4%E6%80%A7%E6%8B%B7%E8%B4%9D"><span class="toc-number">10.2.</span> <span class="toc-text">
          50.必要时进行保护性拷贝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E8%B0%A8%E6%85%8E%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="toc-number">10.3.</span> <span class="toc-text">
          51.谨慎设计方法签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-%E6%98%8E%E6%99%BA%E5%9C%B0%E4%BD%BF%E7%94%A8%E9%87%8D%E8%BD%BD"><span class="toc-number">10.4.</span> <span class="toc-text">
          52.明智地使用重载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E6%98%8E%E6%99%BA%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="toc-number">10.5.</span> <span class="toc-text">
          53.明智地使用可变参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E8%BF%94%E5%9B%9E%E9%9B%B6%E9%95%BF%E5%BA%A6%E7%9A%84%E6%95%B0%E7%BB%84%E6%88%96%E8%80%85%E9%9B%86%E5%90%88%E8%80%8C%E4%B8%8D%E6%98%AFnull"><span class="toc-number">10.6.</span> <span class="toc-text">
          54.返回零长度的数组或者集合而不是null</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#55-%E6%98%8E%E6%99%BA%E5%9C%B0%E8%BF%94%E5%9B%9Eoptional"><span class="toc-number">10.7.</span> <span class="toc-text">
          55.明智地返回optional</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E9%80%9A%E7%94%A8%E7%BC%96%E7%A8%8B"><span class="toc-number">11.</span> <span class="toc-text">
          第九章 通用编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#57-%E5%B0%86%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">11.1.</span> <span class="toc-text">
          57.将局部变量的作用域最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-for-each%E5%BE%AA%E7%8E%AF%E4%BC%98%E4%BA%8E%E4%BC%A0%E7%BB%9F%E5%BE%AA%E7%8E%AF"><span class="toc-number">11.2.</span> <span class="toc-text">
          58.for-each循环优于传统循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#59-%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%BA%93"><span class="toc-number">11.3.</span> <span class="toc-text">
          59.了解和使用类库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60-%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E7%B2%BE%E7%A1%AE%E7%9A%84%E7%AD%94%E6%A1%88%EF%BC%8C%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8float%E5%92%8Cdouble"><span class="toc-number">11.4.</span> <span class="toc-text">
          60.如果需要精确的答案，避免使用float和double</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%85%88%E4%BA%8E%E8%A3%85%E7%AE%B1%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.5.</span> <span class="toc-text">
          61.基本类型优先于装箱基本类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-%E8%8B%A5%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E6%9B%B4%E9%80%82%E5%90%88%EF%BC%8C%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">11.6.</span> <span class="toc-text">
          62.若其他类型更适合，尽量避免使用字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E6%B3%A8%E6%84%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%80%A7%E8%83%BD"><span class="toc-number">11.7.</span> <span class="toc-text">
          63.注意字符串连接的性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E9%80%9A%E8%BF%87%E6%8E%A5%E5%8F%A3%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1"><span class="toc-number">11.8.</span> <span class="toc-text">
          64.通过接口引用对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%85%88%E4%BA%8E%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-number">11.9.</span> <span class="toc-text">
          65.接口优先于反射机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E8%B0%A8%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95"><span class="toc-number">11.10.</span> <span class="toc-text">
          66.谨慎地使用本地方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#67-%E8%B0%A8%E6%85%8E%E5%9C%B0%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96"><span class="toc-number">11.11.</span> <span class="toc-text">
          67.谨慎地进行优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#68-%E9%81%B5%E5%AE%88%E6%99%AE%E9%81%8D%E6%8E%A5%E5%8F%97%E7%9A%84%E5%91%BD%E5%90%8D%E6%83%AF%E4%BE%8B"><span class="toc-number">11.12.</span> <span class="toc-text">
          68.遵守普遍接受的命名惯例</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/131.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">少壮不努力,老大亚托莉</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="mailto:745921536@qq.com" target="_blank" rel="noopener" data-popover="social.745921536@qq.com" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fas fa-envelope"></i></span></a></div><div class="sidebar-ov-feed"><span class="sidebar-ov-feed-rss"><a class="sidebar-ov-feed-rss__link" href="/atom.xml" target="_blank" rel="noopener"><span class="sidebar-ov-feed-rss__icon"><i class="fas fa-rss"></i></span><span>RSS 订阅</span></a></span></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">66</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">6</div><div class="sidebar-ov-state-item__name">分类</div></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>没有眼的鱼</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.xml';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.xml"></script></body></html>